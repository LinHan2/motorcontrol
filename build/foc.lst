ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"foc.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.set_dtc,"ax",%progbits
  20              		.align	1
  21              		.global	set_dtc
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	set_dtc:
  27              	.LVL0:
  28              	.LFB239:
  29              		.file 1 "Core/Src/foc.c"
   1:Core/Src/foc.c **** /*
   2:Core/Src/foc.c ****  * foc.c
   3:Core/Src/foc.c ****  *
   4:Core/Src/foc.c ****  *  Created on: Aug 2, 2020
   5:Core/Src/foc.c ****  *      Author: ben
   6:Core/Src/foc.c ****  */
   7:Core/Src/foc.c **** 
   8:Core/Src/foc.c **** #include "foc.h"
   9:Core/Src/foc.c **** #include "adc.h"
  10:Core/Src/foc.c **** #include "tim.h"
  11:Core/Src/foc.c **** #include "position_sensor.h"
  12:Core/Src/foc.c **** #include "math_ops.h"
  13:Core/Src/foc.c **** #include "hw_config.h"
  14:Core/Src/foc.c **** #include "user_config.h"
  15:Core/Src/foc.c **** 
  16:Core/Src/foc.c **** void set_dtc(ControllerStruct *controller){
  30              		.loc 1 16 43 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
  17:Core/Src/foc.c **** 
  18:Core/Src/foc.c **** 	/* Invert duty cycle if that's how hardware is configured */
  19:Core/Src/foc.c **** 
  20:Core/Src/foc.c **** 	float dtc_u = controller->dtc_u;
  35              		.loc 1 20 2 view .LVU1
  36              		.loc 1 20 8 is_stmt 0 view .LVU2
  37 0000 90ED176A 		vldr.32	s12, [r0, #92]
  38              	.LVL1:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 2


  21:Core/Src/foc.c **** 	float dtc_v = controller->dtc_v;
  39              		.loc 1 21 2 is_stmt 1 view .LVU3
  40              		.loc 1 21 8 is_stmt 0 view .LVU4
  41 0004 90ED187A 		vldr.32	s14, [r0, #96]
  42              	.LVL2:
  22:Core/Src/foc.c **** 	float dtc_w = controller->dtc_w;
  43              		.loc 1 22 2 is_stmt 1 view .LVU5
  44              		.loc 1 22 8 is_stmt 0 view .LVU6
  45 0008 D0ED195A 		vldr.32	s11, [r0, #100]
  46              	.LVL3:
  23:Core/Src/foc.c **** 
  24:Core/Src/foc.c **** 	if(INVERT_DTC){
  47              		.loc 1 24 2 is_stmt 1 view .LVU7
  25:Core/Src/foc.c **** 		dtc_u = 1.0f - controller->dtc_u;
  48              		.loc 1 25 3 view .LVU8
  49              		.loc 1 25 9 is_stmt 0 view .LVU9
  50 000c F7EE007A 		vmov.f32	s15, #1.0e+0
  51 0010 37EEC66A 		vsub.f32	s12, s15, s12
  52              	.LVL4:
  26:Core/Src/foc.c **** 		dtc_v = 1.0f - controller->dtc_v;
  53              		.loc 1 26 3 is_stmt 1 view .LVU10
  54              		.loc 1 26 9 is_stmt 0 view .LVU11
  55 0014 77EEC76A 		vsub.f32	s13, s15, s14
  56              	.LVL5:
  27:Core/Src/foc.c **** 		dtc_w = 1.0f - controller->dtc_w;
  57              		.loc 1 27 3 is_stmt 1 view .LVU12
  58              		.loc 1 27 9 is_stmt 0 view .LVU13
  59 0018 77EEE57A 		vsub.f32	s15, s15, s11
  60              	.LVL6:
  28:Core/Src/foc.c **** 	}
  29:Core/Src/foc.c **** 	/* Handle phase order swapping so that voltage/current/torque match encoder direction */
  30:Core/Src/foc.c **** 	if(!PHASE_ORDER){
  61              		.loc 1 30 2 is_stmt 1 view .LVU14
  62              		.loc 1 30 6 is_stmt 0 view .LVU15
  63 001c 224B     		ldr	r3, .L4
  64 001e 1B68     		ldr	r3, [r3]
  65              		.loc 1 30 4 view .LVU16
  66 0020 03BB     		cbnz	r3, .L2
  31:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_U, ((TIM_PWM.Instance->ARR))*dtc_u);
  67              		.loc 1 31 3 is_stmt 1 view .LVU17
  68 0022 224B     		ldr	r3, .L4+4
  69 0024 1B68     		ldr	r3, [r3]
  70 0026 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  71 002a B8EE477A 		vcvt.f32.u32	s14, s14
  72 002e 27EE067A 		vmul.f32	s14, s14, s12
  73 0032 BCEEC77A 		vcvt.u32.f32	s14, s14
  74 0036 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
  32:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_V, ((TIM_PWM.Instance->ARR))*dtc_v);
  75              		.loc 1 32 3 view .LVU18
  76 003a 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  77 003e B8EE477A 		vcvt.f32.u32	s14, s14
  78 0042 27EE267A 		vmul.f32	s14, s14, s13
  79 0046 BCEEC77A 		vcvt.u32.f32	s14, s14
  80 004a 83ED0E7A 		vstr.32	s14, [r3, #56]	@ int
  33:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_W, ((TIM_PWM.Instance->ARR))*dtc_w);
  81              		.loc 1 33 3 view .LVU19
  82 004e 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 3


  83 0052 B8EE477A 		vcvt.f32.u32	s14, s14
  84 0056 67EE277A 		vmul.f32	s15, s14, s15
  85              	.LVL7:
  86              		.loc 1 33 3 is_stmt 0 view .LVU20
  87 005a FCEEE77A 		vcvt.u32.f32	s15, s15
  88 005e C3ED0F7A 		vstr.32	s15, [r3, #60]	@ int
  89 0062 7047     		bx	lr
  90              	.LVL8:
  91              	.L2:
  34:Core/Src/foc.c **** 	}
  35:Core/Src/foc.c **** 	else{
  36:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_V, ((TIM_PWM.Instance->ARR))*dtc_u);
  92              		.loc 1 36 3 is_stmt 1 view .LVU21
  93 0064 114B     		ldr	r3, .L4+4
  94 0066 1B68     		ldr	r3, [r3]
  95 0068 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  96 006c B8EE477A 		vcvt.f32.u32	s14, s14
  97 0070 27EE067A 		vmul.f32	s14, s14, s12
  98 0074 BCEEC77A 		vcvt.u32.f32	s14, s14
  99 0078 83ED0E7A 		vstr.32	s14, [r3, #56]	@ int
  37:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_U, ((TIM_PWM.Instance->ARR))*dtc_v);
 100              		.loc 1 37 3 view .LVU22
 101 007c 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 102 0080 B8EE477A 		vcvt.f32.u32	s14, s14
 103 0084 27EE267A 		vmul.f32	s14, s14, s13
 104 0088 BCEEC77A 		vcvt.u32.f32	s14, s14
 105 008c 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
  38:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_W, ((TIM_PWM.Instance->ARR))*dtc_w);
 106              		.loc 1 38 3 view .LVU23
 107 0090 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 108 0094 B8EE477A 		vcvt.f32.u32	s14, s14
 109 0098 67EE277A 		vmul.f32	s15, s14, s15
 110              	.LVL9:
 111              		.loc 1 38 3 is_stmt 0 view .LVU24
 112 009c FCEEE77A 		vcvt.u32.f32	s15, s15
 113 00a0 C3ED0F7A 		vstr.32	s15, [r3, #60]	@ int
  39:Core/Src/foc.c **** 	}
  40:Core/Src/foc.c **** }
 114              		.loc 1 40 1 view .LVU25
 115 00a4 7047     		bx	lr
 116              	.L5:
 117 00a6 00BF     		.align	2
 118              	.L4:
 119 00a8 00000000 		.word	__int_reg
 120 00ac 00000000 		.word	htim1
 121              		.cfi_endproc
 122              	.LFE239:
 124              		.section	.text.analog_sample,"ax",%progbits
 125              		.align	1
 126              		.global	analog_sample
 127              		.syntax unified
 128              		.thumb
 129              		.thumb_func
 131              	analog_sample:
 132              	.LVL10:
 133              	.LFB240:
  41:Core/Src/foc.c **** 
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 4


  42:Core/Src/foc.c **** void analog_sample (ControllerStruct *controller){
 134              		.loc 1 42 50 is_stmt 1 view -0
 135              		.cfi_startproc
 136              		@ args = 0, pretend = 0, frame = 0
 137              		@ frame_needed = 0, uses_anonymous_args = 0
 138              		.loc 1 42 50 is_stmt 0 view .LVU27
 139 0000 38B5     		push	{r3, r4, r5, lr}
 140              		.cfi_def_cfa_offset 16
 141              		.cfi_offset 3, -16
 142              		.cfi_offset 4, -12
 143              		.cfi_offset 5, -8
 144              		.cfi_offset 14, -4
 145 0002 0446     		mov	r4, r0
  43:Core/Src/foc.c **** 	/* Sampe ADCs */
  44:Core/Src/foc.c **** 	/* Handle phase order swapping so that voltage/current/torque match encoder direction */
  45:Core/Src/foc.c **** 	if(!PHASE_ORDER){
 146              		.loc 1 45 2 is_stmt 1 view .LVU28
 147              		.loc 1 45 6 is_stmt 0 view .LVU29
 148 0004 264B     		ldr	r3, .L10
 149 0006 1B68     		ldr	r3, [r3]
 150              		.loc 1 45 4 view .LVU30
 151 0008 002B     		cmp	r3, #0
 152 000a 3FD1     		bne	.L7
  46:Core/Src/foc.c **** 		controller->adc_a_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 153              		.loc 1 46 3 is_stmt 1 view .LVU31
 154              		.loc 1 46 27 is_stmt 0 view .LVU32
 155 000c 2548     		ldr	r0, .L10+4
 156              	.LVL11:
 157              		.loc 1 46 27 view .LVU33
 158 000e FFF7FEFF 		bl	HAL_ADC_GetValue
 159              	.LVL12:
 160              		.loc 1 46 25 view .LVU34
 161 0012 6060     		str	r0, [r4, #4]
  47:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IB);
 162              		.loc 1 47 3 is_stmt 1 view .LVU35
 163              		.loc 1 47 27 is_stmt 0 view .LVU36
 164 0014 2448     		ldr	r0, .L10+8
 165 0016 FFF7FEFF 		bl	HAL_ADC_GetValue
 166              	.LVL13:
 167              		.loc 1 47 25 view .LVU37
 168 001a A060     		str	r0, [r4, #8]
 169              	.L8:
  48:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IC;
  49:Core/Src/foc.c **** 	}
  50:Core/Src/foc.c **** 	else{
  51:Core/Src/foc.c **** 		controller->adc_a_raw = HAL_ADC_GetValue(&ADC_CH_IB);
  52:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
  53:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
  54:Core/Src/foc.c **** 	}
  55:Core/Src/foc.c **** 
  56:Core/Src/foc.c **** 
  57:Core/Src/foc.c **** 	HAL_ADC_Start(&ADC_CH_MAIN);
 170              		.loc 1 57 2 is_stmt 1 view .LVU38
 171 001c 214D     		ldr	r5, .L10+4
 172 001e 2846     		mov	r0, r5
 173 0020 FFF7FEFF 		bl	HAL_ADC_Start
 174              	.LVL14:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 5


  58:Core/Src/foc.c **** 	HAL_ADC_PollForConversion(&ADC_CH_MAIN, HAL_MAX_DELAY);
 175              		.loc 1 58 2 view .LVU39
 176 0024 4FF0FF31 		mov	r1, #-1
 177 0028 2846     		mov	r0, r5
 178 002a FFF7FEFF 		bl	HAL_ADC_PollForConversion
 179              	.LVL15:
  59:Core/Src/foc.c **** 
  60:Core/Src/foc.c **** 	controller->adc_vbus_raw = HAL_ADC_GetValue(&ADC_CH_VBUS);
 180              		.loc 1 60 2 view .LVU40
 181              		.loc 1 60 29 is_stmt 0 view .LVU41
 182 002e 1F48     		ldr	r0, .L10+12
 183 0030 FFF7FEFF 		bl	HAL_ADC_GetValue
 184              	.LVL16:
 185              		.loc 1 60 27 view .LVU42
 186 0034 2061     		str	r0, [r4, #16]
  61:Core/Src/foc.c **** 	controller->v_bus = (float)controller->adc_vbus_raw*V_SCALE;
 187              		.loc 1 61 2 is_stmt 1 view .LVU43
 188              		.loc 1 61 22 is_stmt 0 view .LVU44
 189 0036 07EE900A 		vmov	s15, r0	@ int
 190 003a F8EEE77A 		vcvt.f32.s32	s15, s15
 191              		.loc 1 61 53 view .LVU45
 192 003e 9FED1C7A 		vldr.32	s14, .L10+16
 193 0042 67EE877A 		vmul.f32	s15, s15, s14
 194              		.loc 1 61 20 view .LVU46
 195 0046 C4ED087A 		vstr.32	s15, [r4, #32]
  62:Core/Src/foc.c **** 
  63:Core/Src/foc.c ****     controller->i_a = controller->i_scale*(float)(controller->adc_a_raw - controller->adc_a_offset)
 196              		.loc 1 63 5 is_stmt 1 view .LVU47
 197              		.loc 1 63 33 is_stmt 0 view .LVU48
 198 004a D4ED1D6A 		vldr.32	s13, [r4, #116]
 199              		.loc 1 63 61 view .LVU49
 200 004e 6368     		ldr	r3, [r4, #4]
 201              		.loc 1 63 85 view .LVU50
 202 0050 D4F89C20 		ldr	r2, [r4, #156]
 203              		.loc 1 63 73 view .LVU51
 204 0054 9B1A     		subs	r3, r3, r2
 205 0056 07EE903A 		vmov	s15, r3	@ int
 206              		.loc 1 63 43 view .LVU52
 207 005a F8EEE77A 		vcvt.f32.s32	s15, s15
 208              		.loc 1 63 42 view .LVU53
 209 005e 66EEA77A 		vmul.f32	s15, s13, s15
 210              		.loc 1 63 21 view .LVU54
 211 0062 C4ED057A 		vstr.32	s15, [r4, #20]
  64:Core/Src/foc.c ****     controller->i_b = controller->i_scale*(float)(controller->adc_b_raw - controller->adc_b_offset)
 212              		.loc 1 64 5 is_stmt 1 view .LVU55
 213              		.loc 1 64 61 is_stmt 0 view .LVU56
 214 0066 A368     		ldr	r3, [r4, #8]
 215              		.loc 1 64 85 view .LVU57
 216 0068 D4F8A020 		ldr	r2, [r4, #160]
 217              		.loc 1 64 73 view .LVU58
 218 006c 9B1A     		subs	r3, r3, r2
 219 006e 07EE103A 		vmov	s14, r3	@ int
 220              		.loc 1 64 43 view .LVU59
 221 0072 B8EEC77A 		vcvt.f32.s32	s14, s14
 222              		.loc 1 64 42 view .LVU60
 223 0076 26EE877A 		vmul.f32	s14, s13, s14
 224              		.loc 1 64 21 view .LVU61
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 6


 225 007a 84ED067A 		vstr.32	s14, [r4, #24]
  65:Core/Src/foc.c ****     controller->i_c = -controller->i_a - controller->i_b;
 226              		.loc 1 65 5 is_stmt 1 view .LVU62
 227              		.loc 1 65 23 is_stmt 0 view .LVU63
 228 007e F1EE677A 		vneg.f32	s15, s15
 229              		.loc 1 65 40 view .LVU64
 230 0082 77EEC77A 		vsub.f32	s15, s15, s14
 231              		.loc 1 65 21 view .LVU65
 232 0086 C4ED077A 		vstr.32	s15, [r4, #28]
  66:Core/Src/foc.c **** 
  67:Core/Src/foc.c **** }
 233              		.loc 1 67 1 view .LVU66
 234 008a 38BD     		pop	{r3, r4, r5, pc}
 235              	.LVL17:
 236              	.L7:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 237              		.loc 1 51 3 is_stmt 1 view .LVU67
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 238              		.loc 1 51 27 is_stmt 0 view .LVU68
 239 008c 0648     		ldr	r0, .L10+8
 240              	.LVL18:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 241              		.loc 1 51 27 view .LVU69
 242 008e FFF7FEFF 		bl	HAL_ADC_GetValue
 243              	.LVL19:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 244              		.loc 1 51 25 view .LVU70
 245 0092 6060     		str	r0, [r4, #4]
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 246              		.loc 1 52 3 is_stmt 1 view .LVU71
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 247              		.loc 1 52 27 is_stmt 0 view .LVU72
 248 0094 0348     		ldr	r0, .L10+4
 249 0096 FFF7FEFF 		bl	HAL_ADC_GetValue
 250              	.LVL20:
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 251              		.loc 1 52 25 view .LVU73
 252 009a A060     		str	r0, [r4, #8]
 253 009c BEE7     		b	.L8
 254              	.L11:
 255 009e 00BF     		.align	2
 256              	.L10:
 257 00a0 00000000 		.word	__int_reg
 258 00a4 00000000 		.word	hadc1
 259 00a8 00000000 		.word	hadc2
 260 00ac 00000000 		.word	hadc3
 261 00b0 1833533C 		.word	1012085528
 262              		.cfi_endproc
 263              	.LFE240:
 265              		.section	.text.abc,"ax",%progbits
 266              		.align	1
 267              		.global	abc
 268              		.syntax unified
 269              		.thumb
 270              		.thumb_func
 272              	abc:
 273              	.LVL21:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 7


 274              	.LFB241:
  68:Core/Src/foc.c **** 
  69:Core/Src/foc.c **** void abc( float theta, float d, float q, float *a, float *b, float *c){
 275              		.loc 1 69 71 is_stmt 1 view -0
 276              		.cfi_startproc
 277              		@ args = 0, pretend = 0, frame = 0
 278              		@ frame_needed = 0, uses_anonymous_args = 0
 279              		.loc 1 69 71 is_stmt 0 view .LVU75
 280 0000 70B5     		push	{r4, r5, r6, lr}
 281              		.cfi_def_cfa_offset 16
 282              		.cfi_offset 4, -16
 283              		.cfi_offset 5, -12
 284              		.cfi_offset 6, -8
 285              		.cfi_offset 14, -4
 286 0002 2DED048B 		vpush.64	{d8, d9}
 287              		.cfi_def_cfa_offset 32
 288              		.cfi_offset 80, -32
 289              		.cfi_offset 81, -28
 290              		.cfi_offset 82, -24
 291              		.cfi_offset 83, -20
 292 0006 F0EE409A 		vmov.f32	s19, s0
 293 000a B0EE609A 		vmov.f32	s18, s1
 294 000e F0EE418A 		vmov.f32	s17, s2
 295 0012 0646     		mov	r6, r0
 296 0014 0D46     		mov	r5, r1
 297 0016 1446     		mov	r4, r2
  70:Core/Src/foc.c ****     /* Inverse DQ0 Transform
  71:Core/Src/foc.c ****     Phase current amplitude = lengh of dq vector
  72:Core/Src/foc.c ****     i.e. iq = 1, id = 0, peak phase current of 1 */
  73:Core/Src/foc.c **** 
  74:Core/Src/foc.c ****     float cf = cos_lut(theta);
 298              		.loc 1 74 5 is_stmt 1 view .LVU76
 299              		.loc 1 74 16 is_stmt 0 view .LVU77
 300 0018 FFF7FEFF 		bl	cos_lut
 301              	.LVL22:
 302              		.loc 1 74 16 view .LVU78
 303 001c B0EE408A 		vmov.f32	s16, s0
 304              	.LVL23:
  75:Core/Src/foc.c ****     float sf = sin_lut(theta);
 305              		.loc 1 75 5 is_stmt 1 view .LVU79
 306              		.loc 1 75 16 is_stmt 0 view .LVU80
 307 0020 B0EE690A 		vmov.f32	s0, s19
 308              	.LVL24:
 309              		.loc 1 75 16 view .LVU81
 310 0024 FFF7FEFF 		bl	sin_lut
 311              	.LVL25:
  76:Core/Src/foc.c **** 
  77:Core/Src/foc.c ****     *a = cf*d - sf*q;
 312              		.loc 1 77 5 is_stmt 1 view .LVU82
 313              		.loc 1 77 12 is_stmt 0 view .LVU83
 314 0028 68EE097A 		vmul.f32	s15, s16, s18
 315              		.loc 1 77 19 view .LVU84
 316 002c 20EE287A 		vmul.f32	s14, s0, s17
 317              		.loc 1 77 15 view .LVU85
 318 0030 77EEC77A 		vsub.f32	s15, s15, s14
 319              		.loc 1 77 8 view .LVU86
 320 0034 C6ED007A 		vstr.32	s15, [r6]
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 8


  78:Core/Src/foc.c ****     *b = (SQRT3_2*sf-.5f*cf)*d - (-SQRT3_2*cf-.5f*sf)*q;
 321              		.loc 1 78 5 is_stmt 1 view .LVU87
 322              		.loc 1 78 18 is_stmt 0 view .LVU88
 323 0038 9FED166A 		vldr.32	s12, .L14
 324 003c 20EE067A 		vmul.f32	s14, s0, s12
 325              		.loc 1 78 25 view .LVU89
 326 0040 B6EE001A 		vmov.f32	s2, #5.0e-1
 327 0044 68EE010A 		vmul.f32	s1, s16, s2
 328              		.loc 1 78 21 view .LVU90
 329 0048 37EE607A 		vsub.f32	s14, s14, s1
 330              		.loc 1 78 29 view .LVU91
 331 004c 27EE097A 		vmul.f32	s14, s14, s18
 332              		.loc 1 78 43 view .LVU92
 333 0050 DFED117A 		vldr.32	s15, .L14+4
 334 0054 68EE276A 		vmul.f32	s13, s16, s15
 335              		.loc 1 78 50 view .LVU93
 336 0058 20EE011A 		vmul.f32	s2, s0, s2
 337              		.loc 1 78 46 view .LVU94
 338 005c 76EEC16A 		vsub.f32	s13, s13, s2
 339              		.loc 1 78 54 view .LVU95
 340 0060 66EEA86A 		vmul.f32	s13, s13, s17
 341              		.loc 1 78 32 view .LVU96
 342 0064 37EE667A 		vsub.f32	s14, s14, s13
 343              		.loc 1 78 8 view .LVU97
 344 0068 85ED007A 		vstr.32	s14, [r5]
  79:Core/Src/foc.c ****     *c = (-SQRT3_2*sf-.5f*cf)*d - (SQRT3_2*cf-.5f*sf)*q;
 345              		.loc 1 79 5 is_stmt 1 view .LVU98
 346              		.loc 1 79 19 is_stmt 0 view .LVU99
 347 006c 60EE277A 		vmul.f32	s15, s0, s15
 348              		.loc 1 79 22 view .LVU100
 349 0070 77EEE07A 		vsub.f32	s15, s15, s1
 350              		.loc 1 79 30 view .LVU101
 351 0074 67EE890A 		vmul.f32	s1, s15, s18
 352              		.loc 1 79 43 view .LVU102
 353 0078 28EE068A 		vmul.f32	s16, s16, s12
 354              	.LVL26:
 355              		.loc 1 79 46 view .LVU103
 356 007c 38EE418A 		vsub.f32	s16, s16, s2
 357              		.loc 1 79 54 view .LVU104
 358 0080 28EE281A 		vmul.f32	s2, s16, s17
 359              		.loc 1 79 33 view .LVU105
 360 0084 30EEC11A 		vsub.f32	s2, s1, s2
 361              		.loc 1 79 8 view .LVU106
 362 0088 84ED001A 		vstr.32	s2, [r4]
  80:Core/Src/foc.c ****     }
 363              		.loc 1 80 5 view .LVU107
 364 008c BDEC048B 		vldm	sp!, {d8-d9}
 365              		.cfi_restore 82
 366              		.cfi_restore 83
 367              		.cfi_restore 80
 368              		.cfi_restore 81
 369              		.cfi_def_cfa_offset 16
 370              	.LVL27:
 371              		.loc 1 80 5 view .LVU108
 372 0090 70BD     		pop	{r4, r5, r6, pc}
 373              	.LVL28:
 374              	.L15:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 9


 375              		.loc 1 80 5 view .LVU109
 376 0092 00BF     		.align	2
 377              	.L14:
 378 0094 D7B35D3F 		.word	1063105495
 379 0098 D7B35DBF 		.word	-1084378153
 380              		.cfi_endproc
 381              	.LFE241:
 383              		.section	.text.dq0,"ax",%progbits
 384              		.align	1
 385              		.global	dq0
 386              		.syntax unified
 387              		.thumb
 388              		.thumb_func
 390              	dq0:
 391              	.LVL29:
 392              	.LFB242:
  81:Core/Src/foc.c **** 
  82:Core/Src/foc.c **** 
  83:Core/Src/foc.c **** void dq0(float theta, float a, float b, float c, float *d, float *q){
 393              		.loc 1 83 69 is_stmt 1 view -0
 394              		.cfi_startproc
 395              		@ args = 0, pretend = 0, frame = 0
 396              		@ frame_needed = 0, uses_anonymous_args = 0
 397              		.loc 1 83 69 is_stmt 0 view .LVU111
 398 0000 38B5     		push	{r3, r4, r5, lr}
 399              		.cfi_def_cfa_offset 16
 400              		.cfi_offset 3, -16
 401              		.cfi_offset 4, -12
 402              		.cfi_offset 5, -8
 403              		.cfi_offset 14, -4
 404 0002 2DED068B 		vpush.64	{d8, d9, d10}
 405              		.cfi_def_cfa_offset 40
 406              		.cfi_offset 80, -40
 407              		.cfi_offset 81, -36
 408              		.cfi_offset 82, -32
 409              		.cfi_offset 83, -28
 410              		.cfi_offset 84, -24
 411              		.cfi_offset 85, -20
 412 0006 B0EE40AA 		vmov.f32	s20, s0
 413 000a B0EE608A 		vmov.f32	s16, s1
 414 000e F0EE419A 		vmov.f32	s19, s2
 415 0012 B0EE619A 		vmov.f32	s18, s3
 416 0016 0546     		mov	r5, r0
 417 0018 0C46     		mov	r4, r1
  84:Core/Src/foc.c ****     /* DQ0 Transform
  85:Core/Src/foc.c ****     Phase current amplitude = lengh of dq vector
  86:Core/Src/foc.c ****     i.e. iq = 1, id = 0, peak phase current of 1*/
  87:Core/Src/foc.c **** 
  88:Core/Src/foc.c ****     float cf = cos_lut(theta);
 418              		.loc 1 88 5 is_stmt 1 view .LVU112
 419              		.loc 1 88 16 is_stmt 0 view .LVU113
 420 001a FFF7FEFF 		bl	cos_lut
 421              	.LVL30:
 422              		.loc 1 88 16 view .LVU114
 423 001e F0EE408A 		vmov.f32	s17, s0
 424              	.LVL31:
  89:Core/Src/foc.c ****     float sf = sin_lut(theta);
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 10


 425              		.loc 1 89 5 is_stmt 1 view .LVU115
 426              		.loc 1 89 16 is_stmt 0 view .LVU116
 427 0022 B0EE4A0A 		vmov.f32	s0, s20
 428              	.LVL32:
 429              		.loc 1 89 16 view .LVU117
 430 0026 FFF7FEFF 		bl	sin_lut
 431              	.LVL33:
  90:Core/Src/foc.c **** 
  91:Core/Src/foc.c ****     *d = 0.6666667f*(cf*a + (SQRT3_2*sf-.5f*cf)*b + (-SQRT3_2*sf-.5f*cf)*c);   ///Faster DQ0 Transf
 432              		.loc 1 91 5 is_stmt 1 view .LVU118
 433              		.loc 1 91 24 is_stmt 0 view .LVU119
 434 002a 28EE887A 		vmul.f32	s14, s17, s16
 435              		.loc 1 91 37 view .LVU120
 436 002e DFED1C1A 		vldr.32	s3, .L18
 437 0032 60EE217A 		vmul.f32	s15, s0, s3
 438              		.loc 1 91 44 view .LVU121
 439 0036 B6EE006A 		vmov.f32	s12, #5.0e-1
 440 003a 68EE865A 		vmul.f32	s11, s17, s12
 441              		.loc 1 91 40 view .LVU122
 442 003e 77EEE57A 		vsub.f32	s15, s15, s11
 443              		.loc 1 91 48 view .LVU123
 444 0042 67EEA97A 		vmul.f32	s15, s15, s19
 445              		.loc 1 91 27 view .LVU124
 446 0046 37EE277A 		vadd.f32	s14, s14, s15
 447              		.loc 1 91 62 view .LVU125
 448 004a DFED167A 		vldr.32	s15, .L18+4
 449 004e 60EE276A 		vmul.f32	s13, s0, s15
 450              		.loc 1 91 65 view .LVU126
 451 0052 76EEE56A 		vsub.f32	s13, s13, s11
 452              		.loc 1 91 73 view .LVU127
 453 0056 66EE896A 		vmul.f32	s13, s13, s18
 454              		.loc 1 91 51 view .LVU128
 455 005a 37EE267A 		vadd.f32	s14, s14, s13
 456              		.loc 1 91 20 view .LVU129
 457 005e DFED126A 		vldr.32	s13, .L18+8
 458 0062 27EE267A 		vmul.f32	s14, s14, s13
 459              		.loc 1 91 8 view .LVU130
 460 0066 85ED007A 		vstr.32	s14, [r5]
  92:Core/Src/foc.c ****     *q = 0.6666667f*(-sf*a - (-SQRT3_2*cf-.5f*sf)*b - (SQRT3_2*cf-.5f*sf)*c);
 461              		.loc 1 92 5 is_stmt 1 view .LVU131
 462              		.loc 1 92 25 is_stmt 0 view .LVU132
 463 006a 20EE488A 		vnmul.f32	s16, s0, s16
 464              	.LVL34:
 465              		.loc 1 92 39 view .LVU133
 466 006e 68EEA77A 		vmul.f32	s15, s17, s15
 467              		.loc 1 92 46 view .LVU134
 468 0072 20EE060A 		vmul.f32	s0, s0, s12
 469              	.LVL35:
 470              		.loc 1 92 42 view .LVU135
 471 0076 77EEC07A 		vsub.f32	s15, s15, s0
 472              		.loc 1 92 50 view .LVU136
 473 007a 27EEA91A 		vmul.f32	s2, s15, s19
 474              		.loc 1 92 28 view .LVU137
 475 007e 38EE418A 		vsub.f32	s16, s16, s2
 476              		.loc 1 92 63 view .LVU138
 477 0082 68EEA18A 		vmul.f32	s17, s17, s3
 478              	.LVL36:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 11


 479              		.loc 1 92 66 view .LVU139
 480 0086 78EEC08A 		vsub.f32	s17, s17, s0
 481              		.loc 1 92 74 view .LVU140
 482 008a 68EE891A 		vmul.f32	s3, s17, s18
 483              		.loc 1 92 53 view .LVU141
 484 008e 38EE618A 		vsub.f32	s16, s16, s3
 485              		.loc 1 92 20 view .LVU142
 486 0092 28EE268A 		vmul.f32	s16, s16, s13
 487              		.loc 1 92 8 view .LVU143
 488 0096 84ED008A 		vstr.32	s16, [r4]
  93:Core/Src/foc.c **** 
  94:Core/Src/foc.c ****     }
 489              		.loc 1 94 5 view .LVU144
 490 009a BDEC068B 		vldm	sp!, {d8-d10}
 491              		.cfi_restore 84
 492              		.cfi_restore 85
 493              		.cfi_restore 82
 494              		.cfi_restore 83
 495              		.cfi_restore 80
 496              		.cfi_restore 81
 497              		.cfi_def_cfa_offset 16
 498              	.LVL37:
 499              		.loc 1 94 5 view .LVU145
 500 009e 38BD     		pop	{r3, r4, r5, pc}
 501              	.LVL38:
 502              	.L19:
 503              		.loc 1 94 5 view .LVU146
 504              		.align	2
 505              	.L18:
 506 00a0 D7B35D3F 		.word	1063105495
 507 00a4 D7B35DBF 		.word	-1084378153
 508 00a8 ABAA2A3F 		.word	1059760811
 509              		.cfi_endproc
 510              	.LFE242:
 512              		.section	.text.svm,"ax",%progbits
 513              		.align	1
 514              		.global	svm
 515              		.syntax unified
 516              		.thumb
 517              		.thumb_func
 519              	svm:
 520              	.LVL39:
 521              	.LFB243:
  95:Core/Src/foc.c **** 
  96:Core/Src/foc.c **** void svm(float v_max, float u, float v, float w, float *dtc_u, float *dtc_v, float *dtc_w){
 522              		.loc 1 96 91 is_stmt 1 view -0
 523              		.cfi_startproc
 524              		@ args = 0, pretend = 0, frame = 0
 525              		@ frame_needed = 0, uses_anonymous_args = 0
 526              		.loc 1 96 91 is_stmt 0 view .LVU148
 527 0000 70B5     		push	{r4, r5, r6, lr}
 528              		.cfi_def_cfa_offset 16
 529              		.cfi_offset 4, -16
 530              		.cfi_offset 5, -12
 531              		.cfi_offset 6, -8
 532              		.cfi_offset 14, -4
 533 0002 2DED088B 		vpush.64	{d8, d9, d10, d11}
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 12


 534              		.cfi_def_cfa_offset 48
 535              		.cfi_offset 80, -48
 536              		.cfi_offset 81, -44
 537              		.cfi_offset 82, -40
 538              		.cfi_offset 83, -36
 539              		.cfi_offset 84, -32
 540              		.cfi_offset 85, -28
 541              		.cfi_offset 86, -24
 542              		.cfi_offset 87, -20
 543 0006 B0EE40AA 		vmov.f32	s20, s0
 544 000a F0EE609A 		vmov.f32	s19, s1
 545 000e B0EE419A 		vmov.f32	s18, s2
 546 0012 B0EE618A 		vmov.f32	s16, s3
 547 0016 0646     		mov	r6, r0
 548 0018 0D46     		mov	r5, r1
 549 001a 1446     		mov	r4, r2
  97:Core/Src/foc.c ****     /* Space Vector Modulation
  98:Core/Src/foc.c ****      u,v,w amplitude = v_bus for full modulation depth */
  99:Core/Src/foc.c **** 
 100:Core/Src/foc.c ****     float v_offset = (fminf3(u, v, w) + fmaxf3(u, v, w))*0.5f;
 550              		.loc 1 100 5 is_stmt 1 view .LVU149
 551              		.loc 1 100 23 is_stmt 0 view .LVU150
 552 001c B0EE611A 		vmov.f32	s2, s3
 553              	.LVL40:
 554              		.loc 1 100 23 view .LVU151
 555 0020 F0EE490A 		vmov.f32	s1, s18
 556              	.LVL41:
 557              		.loc 1 100 23 view .LVU152
 558 0024 B0EE690A 		vmov.f32	s0, s19
 559              	.LVL42:
 560              		.loc 1 100 23 view .LVU153
 561 0028 FFF7FEFF 		bl	fminf3
 562              	.LVL43:
 563              		.loc 1 100 23 view .LVU154
 564 002c F0EE408A 		vmov.f32	s17, s0
 565              		.loc 1 100 41 view .LVU155
 566 0030 B0EE481A 		vmov.f32	s2, s16
 567 0034 F0EE490A 		vmov.f32	s1, s18
 568 0038 B0EE690A 		vmov.f32	s0, s19
 569 003c FFF7FEFF 		bl	fmaxf3
 570              	.LVL44:
 571              		.loc 1 100 39 view .LVU156
 572 0040 78EE808A 		vadd.f32	s17, s17, s0
 573              		.loc 1 100 11 view .LVU157
 574 0044 F6EE00AA 		vmov.f32	s21, #5.0e-1
 575 0048 68EEAA8A 		vmul.f32	s17, s17, s21
 576              	.LVL45:
 101:Core/Src/foc.c ****     float v_midpoint = .5f*(DTC_MAX+DTC_MIN);
 577              		.loc 1 101 5 is_stmt 1 view .LVU158
 102:Core/Src/foc.c **** 
 103:Core/Src/foc.c ****     *dtc_u = fast_fminf(fast_fmaxf((.5f*(u -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 578              		.loc 1 103 5 view .LVU159
 579              		.loc 1 103 44 is_stmt 0 view .LVU160
 580 004c 79EEE89A 		vsub.f32	s19, s19, s17
 581              	.LVL46:
 582              		.loc 1 103 54 view .LVU161
 583 0050 69EEAA9A 		vmul.f32	s19, s19, s21
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 13


 584              		.loc 1 103 69 view .LVU162
 585 0054 89EE8A0A 		vdiv.f32	s0, s19, s20
 586              		.loc 1 103 14 view .LVU163
 587 0058 DFED1CBA 		vldr.32	s23, .L22
 588 005c 9FED1CBA 		vldr.32	s22, .L22+4
 589 0060 F0EE6B0A 		vmov.f32	s1, s23
 590 0064 30EE0B0A 		vadd.f32	s0, s0, s22
 591 0068 FFF7FEFF 		bl	fast_fmaxf
 592              	.LVL47:
 593 006c DFED199A 		vldr.32	s19, .L22+8
 594 0070 F0EE690A 		vmov.f32	s1, s19
 595 0074 FFF7FEFF 		bl	fast_fminf
 596              	.LVL48:
 597              		.loc 1 103 12 view .LVU164
 598 0078 86ED000A 		vstr.32	s0, [r6]
 104:Core/Src/foc.c ****     *dtc_v = fast_fminf(fast_fmaxf((.5f*(v -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 599              		.loc 1 104 5 is_stmt 1 view .LVU165
 600              		.loc 1 104 44 is_stmt 0 view .LVU166
 601 007c 39EE689A 		vsub.f32	s18, s18, s17
 602              	.LVL49:
 603              		.loc 1 104 54 view .LVU167
 604 0080 29EE2A9A 		vmul.f32	s18, s18, s21
 605              		.loc 1 104 69 view .LVU168
 606 0084 89EE0A0A 		vdiv.f32	s0, s18, s20
 607              		.loc 1 104 14 view .LVU169
 608 0088 F0EE6B0A 		vmov.f32	s1, s23
 609 008c 30EE0B0A 		vadd.f32	s0, s0, s22
 610 0090 FFF7FEFF 		bl	fast_fmaxf
 611              	.LVL50:
 612 0094 F0EE690A 		vmov.f32	s1, s19
 613 0098 FFF7FEFF 		bl	fast_fminf
 614              	.LVL51:
 615              		.loc 1 104 12 view .LVU170
 616 009c 85ED000A 		vstr.32	s0, [r5]
 105:Core/Src/foc.c ****     *dtc_w = fast_fminf(fast_fmaxf((.5f*(w -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 617              		.loc 1 105 5 is_stmt 1 view .LVU171
 618              		.loc 1 105 44 is_stmt 0 view .LVU172
 619 00a0 38EE688A 		vsub.f32	s16, s16, s17
 620              	.LVL52:
 621              		.loc 1 105 54 view .LVU173
 622 00a4 28EE2A8A 		vmul.f32	s16, s16, s21
 623              		.loc 1 105 69 view .LVU174
 624 00a8 88EE0A0A 		vdiv.f32	s0, s16, s20
 625              		.loc 1 105 14 view .LVU175
 626 00ac F0EE6B0A 		vmov.f32	s1, s23
 627 00b0 30EE0B0A 		vadd.f32	s0, s0, s22
 628 00b4 FFF7FEFF 		bl	fast_fmaxf
 629              	.LVL53:
 630 00b8 F0EE690A 		vmov.f32	s1, s19
 631 00bc FFF7FEFF 		bl	fast_fminf
 632              	.LVL54:
 633              		.loc 1 105 12 view .LVU176
 634 00c0 84ED000A 		vstr.32	s0, [r4]
 106:Core/Src/foc.c **** 
 107:Core/Src/foc.c ****     }
 635              		.loc 1 107 5 view .LVU177
 636 00c4 BDEC088B 		vldm	sp!, {d8-d11}
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 14


 637              		.cfi_restore 86
 638              		.cfi_restore 87
 639              		.cfi_restore 84
 640              		.cfi_restore 85
 641              		.cfi_restore 82
 642              		.cfi_restore 83
 643              		.cfi_restore 80
 644              		.cfi_restore 81
 645              		.cfi_def_cfa_offset 16
 646              	.LVL55:
 647              		.loc 1 107 5 view .LVU178
 648 00c8 70BD     		pop	{r4, r5, r6, pc}
 649              	.LVL56:
 650              	.L23:
 651              		.loc 1 107 5 view .LVU179
 652 00ca 00BF     		.align	2
 653              	.L22:
 654 00cc 00000000 		.word	0
 655 00d0 D7A3F03E 		.word	1055957975
 656 00d4 D7A3703F 		.word	1064346583
 657              		.cfi_endproc
 658              	.LFE243:
 660              		.section	.text.zero_current,"ax",%progbits
 661              		.align	1
 662              		.global	zero_current
 663              		.syntax unified
 664              		.thumb
 665              		.thumb_func
 667              	zero_current:
 668              	.LVL57:
 669              	.LFB244:
 108:Core/Src/foc.c **** 
 109:Core/Src/foc.c **** void zero_current(ControllerStruct *controller){
 670              		.loc 1 109 48 is_stmt 1 view -0
 671              		.cfi_startproc
 672              		@ args = 0, pretend = 0, frame = 0
 673              		@ frame_needed = 0, uses_anonymous_args = 0
 674              		.loc 1 109 48 is_stmt 0 view .LVU181
 675 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 676              		.cfi_def_cfa_offset 24
 677              		.cfi_offset 3, -24
 678              		.cfi_offset 4, -20
 679              		.cfi_offset 5, -16
 680              		.cfi_offset 6, -12
 681              		.cfi_offset 7, -8
 682              		.cfi_offset 14, -4
 683 0002 0446     		mov	r4, r0
 110:Core/Src/foc.c **** 	/* Measure zero-current ADC offset */
 111:Core/Src/foc.c **** 
 112:Core/Src/foc.c ****     int adc_a_offset = 0;
 684              		.loc 1 112 5 is_stmt 1 view .LVU182
 685              	.LVL58:
 113:Core/Src/foc.c ****     int adc_b_offset = 0;
 686              		.loc 1 113 5 view .LVU183
 114:Core/Src/foc.c ****     int n = 1000;
 687              		.loc 1 114 5 view .LVU184
 115:Core/Src/foc.c ****     controller->dtc_u = 0.f;
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 15


 688              		.loc 1 115 5 view .LVU185
 689              		.loc 1 115 23 is_stmt 0 view .LVU186
 690 0004 0023     		movs	r3, #0
 691 0006 C365     		str	r3, [r0, #92]	@ float
 116:Core/Src/foc.c ****     controller->dtc_v = 0.f;
 692              		.loc 1 116 5 is_stmt 1 view .LVU187
 693              		.loc 1 116 23 is_stmt 0 view .LVU188
 694 0008 0366     		str	r3, [r0, #96]	@ float
 117:Core/Src/foc.c ****     controller->dtc_w = 0.f;
 695              		.loc 1 117 5 is_stmt 1 view .LVU189
 696              		.loc 1 117 23 is_stmt 0 view .LVU190
 697 000a 4366     		str	r3, [r0, #100]	@ float
 118:Core/Src/foc.c ****     set_dtc(controller);
 698              		.loc 1 118 5 is_stmt 1 view .LVU191
 699 000c FFF7FEFF 		bl	set_dtc
 700              	.LVL59:
 119:Core/Src/foc.c **** 
 120:Core/Src/foc.c ****     for (int i = 0; i<n; i++){               // Average n samples
 701              		.loc 1 120 5 view .LVU192
 702              	.LBB2:
 703              		.loc 1 120 10 view .LVU193
 704              		.loc 1 120 14 is_stmt 0 view .LVU194
 705 0010 0025     		movs	r5, #0
 706              	.LBE2:
 113:Core/Src/foc.c ****     int n = 1000;
 707              		.loc 1 113 9 view .LVU195
 708 0012 2E46     		mov	r6, r5
 112:Core/Src/foc.c ****     int adc_b_offset = 0;
 709              		.loc 1 112 9 view .LVU196
 710 0014 2F46     		mov	r7, r5
 711              	.LBB3:
 712              		.loc 1 120 5 view .LVU197
 713 0016 07E0     		b	.L25
 714              	.LVL60:
 715              	.L26:
 121:Core/Src/foc.c ****     	analog_sample(controller);
 716              		.loc 1 121 6 is_stmt 1 discriminator 3 view .LVU198
 717 0018 2046     		mov	r0, r4
 718 001a FFF7FEFF 		bl	analog_sample
 719              	.LVL61:
 122:Core/Src/foc.c ****     	adc_a_offset +=  controller->adc_a_raw;
 720              		.loc 1 122 6 discriminator 3 view .LVU199
 721              		.loc 1 122 33 is_stmt 0 discriminator 3 view .LVU200
 722 001e 6368     		ldr	r3, [r4, #4]
 723              		.loc 1 122 19 discriminator 3 view .LVU201
 724 0020 1F44     		add	r7, r7, r3
 725              	.LVL62:
 123:Core/Src/foc.c ****     	adc_b_offset += controller->adc_b_raw;
 726              		.loc 1 123 6 is_stmt 1 discriminator 3 view .LVU202
 727              		.loc 1 123 32 is_stmt 0 discriminator 3 view .LVU203
 728 0022 A368     		ldr	r3, [r4, #8]
 729              		.loc 1 123 19 discriminator 3 view .LVU204
 730 0024 1E44     		add	r6, r6, r3
 731              	.LVL63:
 120:Core/Src/foc.c ****     	analog_sample(controller);
 732              		.loc 1 120 26 is_stmt 1 discriminator 3 view .LVU205
 120:Core/Src/foc.c ****     	analog_sample(controller);
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 16


 733              		.loc 1 120 27 is_stmt 0 discriminator 3 view .LVU206
 734 0026 0135     		adds	r5, r5, #1
 735              	.LVL64:
 736              	.L25:
 120:Core/Src/foc.c ****     	analog_sample(controller);
 737              		.loc 1 120 21 is_stmt 1 discriminator 1 view .LVU207
 120:Core/Src/foc.c ****     	analog_sample(controller);
 738              		.loc 1 120 5 is_stmt 0 discriminator 1 view .LVU208
 739 0028 B5F57A7F 		cmp	r5, #1000
 740 002c F4DB     		blt	.L26
 741              	.LBE3:
 124:Core/Src/foc.c ****      }
 125:Core/Src/foc.c ****     controller->adc_a_offset = adc_a_offset/n;
 742              		.loc 1 125 5 is_stmt 1 view .LVU209
 743              		.loc 1 125 44 is_stmt 0 view .LVU210
 744 002e 084A     		ldr	r2, .L28
 745 0030 82FB0731 		smull	r3, r1, r2, r7
 746 0034 FB17     		asrs	r3, r7, #31
 747 0036 C3EBA113 		rsb	r3, r3, r1, asr #6
 748              		.loc 1 125 30 view .LVU211
 749 003a C4F89C30 		str	r3, [r4, #156]
 126:Core/Src/foc.c ****     controller->adc_b_offset = adc_b_offset/n;
 750              		.loc 1 126 5 is_stmt 1 view .LVU212
 751              		.loc 1 126 44 is_stmt 0 view .LVU213
 752 003e 82FB0632 		smull	r3, r2, r2, r6
 753 0042 F317     		asrs	r3, r6, #31
 754 0044 C3EBA213 		rsb	r3, r3, r2, asr #6
 755              		.loc 1 126 30 view .LVU214
 756 0048 C4F8A030 		str	r3, [r4, #160]
 127:Core/Src/foc.c **** 
 128:Core/Src/foc.c ****     }
 757              		.loc 1 128 5 view .LVU215
 758 004c F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 759              	.LVL65:
 760              	.L29:
 761              		.loc 1 128 5 view .LVU216
 762 004e 00BF     		.align	2
 763              	.L28:
 764 0050 D34D6210 		.word	274877907
 765              		.cfi_endproc
 766              	.LFE244:
 768              		.global	__aeabi_f2d
 769              		.global	__aeabi_dmul
 770              		.global	__aeabi_dadd
 771              		.global	__aeabi_d2f
 772              		.section	.text.init_controller_params,"ax",%progbits
 773              		.align	1
 774              		.global	init_controller_params
 775              		.syntax unified
 776              		.thumb
 777              		.thumb_func
 779              	init_controller_params:
 780              	.LVL66:
 781              	.LFB245:
 129:Core/Src/foc.c **** 
 130:Core/Src/foc.c **** void init_controller_params(ControllerStruct *controller){
 782              		.loc 1 130 58 is_stmt 1 view -0
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 17


 783              		.cfi_startproc
 784              		@ args = 0, pretend = 0, frame = 0
 785              		@ frame_needed = 0, uses_anonymous_args = 0
 786              		.loc 1 130 58 is_stmt 0 view .LVU218
 787 0000 38B5     		push	{r3, r4, r5, lr}
 788              		.cfi_def_cfa_offset 16
 789              		.cfi_offset 3, -16
 790              		.cfi_offset 4, -12
 791              		.cfi_offset 5, -8
 792              		.cfi_offset 14, -4
 793 0002 0546     		mov	r5, r0
 131:Core/Src/foc.c **** 
 132:Core/Src/foc.c **** 	controller->ki_d = KI_D;
 794              		.loc 1 132 2 is_stmt 1 view .LVU219
 795              		.loc 1 132 19 is_stmt 0 view .LVU220
 796 0004 374B     		ldr	r3, .L39
 797 0006 C0F88030 		str	r3, [r0, #128]	@ float
 133:Core/Src/foc.c ****     controller->ki_q = KI_Q;
 798              		.loc 1 133 5 is_stmt 1 view .LVU221
 799              		.loc 1 133 22 is_stmt 0 view .LVU222
 800 000a C0F88430 		str	r3, [r0, #132]	@ float
 134:Core/Src/foc.c ****     controller->k_d = K_SCALE*I_BW;
 801              		.loc 1 134 5 is_stmt 1 view .LVU223
 802              		.loc 1 134 31 is_stmt 0 view .LVU224
 803 000e 364B     		ldr	r3, .L39+4
 804 0010 D3ED027A 		vldr.32	s15, [r3, #8]
 805              		.loc 1 134 30 view .LVU225
 806 0014 9FED357A 		vldr.32	s14, .L39+8
 807 0018 27EE877A 		vmul.f32	s14, s15, s14
 808              		.loc 1 134 21 view .LVU226
 809 001c 80ED1E7A 		vstr.32	s14, [r0, #120]
 135:Core/Src/foc.c ****     controller->k_q = K_SCALE*I_BW;
 810              		.loc 1 135 5 is_stmt 1 view .LVU227
 811              		.loc 1 135 21 is_stmt 0 view .LVU228
 812 0020 80ED1F7A 		vstr.32	s14, [r0, #124]
 136:Core/Src/foc.c ****     controller->alpha = 1.0f - 1.0f/(1.0f - DT*I_BW*TWO_PI_F);
 813              		.loc 1 136 5 is_stmt 1 view .LVU229
 814              		.loc 1 136 47 is_stmt 0 view .LVU230
 815 0024 9FED327A 		vldr.32	s14, .L39+12
 816 0028 67EE877A 		vmul.f32	s15, s15, s14
 817              		.loc 1 136 52 view .LVU231
 818 002c 9FED317A 		vldr.32	s14, .L39+16
 819 0030 67EE877A 		vmul.f32	s15, s15, s14
 820              		.loc 1 136 43 view .LVU232
 821 0034 B7EE007A 		vmov.f32	s14, #1.0e+0
 822 0038 77EE677A 		vsub.f32	s15, s14, s15
 823              		.loc 1 136 36 view .LVU233
 824 003c C7EE276A 		vdiv.f32	s13, s14, s15
 825              		.loc 1 136 30 view .LVU234
 826 0040 37EE667A 		vsub.f32	s14, s14, s13
 827              		.loc 1 136 23 view .LVU235
 828 0044 80ED237A 		vstr.32	s14, [r0, #140]
 137:Core/Src/foc.c ****     controller->ki_fw = .1f*controller->ki_d;
 829              		.loc 1 137 5 is_stmt 1 view .LVU236
 830              		.loc 1 137 23 is_stmt 0 view .LVU237
 831 0048 2B4A     		ldr	r2, .L39+20
 832 004a C0F88820 		str	r2, [r0, #136]	@ float
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 18


 138:Core/Src/foc.c ****     controller->phase_order = PHASE_ORDER;
 833              		.loc 1 138 5 is_stmt 1 view .LVU238
 834              		.loc 1 138 31 is_stmt 0 view .LVU239
 835 004e 2B4A     		ldr	r2, .L39+24
 836 0050 1268     		ldr	r2, [r2]
 837              		.loc 1 138 29 view .LVU240
 838 0052 C0F8D420 		str	r2, [r0, #212]
 139:Core/Src/foc.c ****     controller->flux_linkage = KT/(1.5f*PPAIRS);
 839              		.loc 1 139 5 is_stmt 1 view .LVU241
 840              		.loc 1 139 32 is_stmt 0 view .LVU242
 841 0056 D3ED0E6A 		vldr.32	s13, [r3, #56]
 842              		.loc 1 139 41 view .LVU243
 843 005a D3ED0A7A 		vldr.32	s15, [r3, #40]
 844              		.loc 1 139 40 view .LVU244
 845 005e B7EE087A 		vmov.f32	s14, #1.5e+0
 846 0062 67EE877A 		vmul.f32	s15, s15, s14
 847              		.loc 1 139 34 view .LVU245
 848 0066 86EEA77A 		vdiv.f32	s14, s13, s15
 849              		.loc 1 139 30 view .LVU246
 850 006a 80ED247A 		vstr.32	s14, [r0, #144]
 140:Core/Src/foc.c ****     if(I_MAX <= 40.0f){controller->i_scale = I_SCALE;}
 851              		.loc 1 140 5 is_stmt 1 view .LVU247
 852              		.loc 1 140 8 is_stmt 0 view .LVU248
 853 006e 93ED037A 		vldr.32	s14, [r3, #12]
 854              		.loc 1 140 7 view .LVU249
 855 0072 DFED237A 		vldr.32	s15, .L39+28
 856 0076 B4EEE77A 		vcmpe.f32	s14, s15
 857 007a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 858 007e 03D8     		bhi	.L37
 859              		.loc 1 140 24 is_stmt 1 discriminator 1 view .LVU250
 860              		.loc 1 140 44 is_stmt 0 discriminator 1 view .LVU251
 861 0080 204B     		ldr	r3, .L39+32
 862 0082 4367     		str	r3, [r0, #116]	@ float
 863              	.L34:
 130:Core/Src/foc.c **** 
 864              		.loc 1 130 58 discriminator 1 view .LVU252
 865 0084 0024     		movs	r4, #0
 866 0086 29E0     		b	.L33
 867              	.L37:
 141:Core/Src/foc.c ****     else{controller->i_scale = 2.0f*I_SCALE;}
 868              		.loc 1 141 10 is_stmt 1 view .LVU253
 869              		.loc 1 141 30 is_stmt 0 view .LVU254
 870 0088 1F4B     		ldr	r3, .L39+36
 871 008a 4367     		str	r3, [r0, #116]	@ float
 872 008c FAE7     		b	.L34
 873              	.LVL67:
 874              	.L35:
 875              	.LBB4:
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 143:Core/Src/foc.c ****     {
 144:Core/Src/foc.c ****         controller->inverter_tab[i] = 1.0f + 1.2f*exp(-0.0078125f*i/.032f);
 876              		.loc 1 144 9 is_stmt 1 discriminator 3 view .LVU255
 877              		.loc 1 144 66 is_stmt 0 discriminator 3 view .LVU256
 878 008e 07EE904A 		vmov	s15, r4	@ int
 879 0092 F8EEE77A 		vcvt.f32.s32	s15, s15
 880 0096 9FED1D7A 		vldr.32	s14, .L39+40
 881 009a 67EE877A 		vmul.f32	s15, s15, s14
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 19


 882              		.loc 1 144 51 discriminator 3 view .LVU257
 883 009e 9FED1C7A 		vldr.32	s14, .L39+44
 884 00a2 C7EE877A 		vdiv.f32	s15, s15, s14
 885 00a6 17EE900A 		vmov	r0, s15
 886 00aa FFF7FEFF 		bl	__aeabi_f2d
 887              	.LVL68:
 888 00ae 41EC100B 		vmov	d0, r0, r1
 889 00b2 FFF7FEFF 		bl	exp
 890              	.LVL69:
 891              		.loc 1 144 50 discriminator 3 view .LVU258
 892 00b6 4FF08042 		mov	r2, #1073741824
 893 00ba 164B     		ldr	r3, .L39+48
 894 00bc 51EC100B 		vmov	r0, r1, d0
 895 00c0 FFF7FEFF 		bl	__aeabi_dmul
 896              	.LVL70:
 897              		.loc 1 144 44 discriminator 3 view .LVU259
 898 00c4 0022     		movs	r2, #0
 899 00c6 144B     		ldr	r3, .L39+52
 900 00c8 FFF7FEFF 		bl	__aeabi_dadd
 901              	.LVL71:
 902 00cc FFF7FEFF 		bl	__aeabi_d2f
 903              	.LVL72:
 904              		.loc 1 144 37 discriminator 3 view .LVU260
 905 00d0 04F14003 		add	r3, r4, #64
 906 00d4 05EB8303 		add	r3, r5, r3, lsl #2
 907 00d8 5860     		str	r0, [r3, #4]	@ float
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 908              		.loc 1 142 27 is_stmt 1 discriminator 3 view .LVU261
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 909              		.loc 1 142 28 is_stmt 0 discriminator 3 view .LVU262
 910 00da 0134     		adds	r4, r4, #1
 911              	.LVL73:
 912              	.L33:
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 913              		.loc 1 142 20 is_stmt 1 discriminator 1 view .LVU263
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 914              		.loc 1 142 5 is_stmt 0 discriminator 1 view .LVU264
 915 00dc 7F2C     		cmp	r4, #127
 916 00de D6DD     		ble	.L35
 917              	.LBE4:
 145:Core/Src/foc.c ****     }
 146:Core/Src/foc.c **** 
 147:Core/Src/foc.c ****     }
 918              		.loc 1 147 5 view .LVU265
 919 00e0 38BD     		pop	{r3, r4, r5, pc}
 920              	.LVL74:
 921              	.L40:
 922              		.loc 1 147 5 view .LVU266
 923 00e2 00BF     		.align	2
 924              	.L39:
 925 00e4 EC51B83E 		.word	1052266988
 926 00e8 00000000 		.word	__float_reg
 927 00ec 82A8FB38 		.word	956016770
 928 00f0 17B7D137 		.word	936490775
 929 00f4 DB0FC940 		.word	1086918619
 930 00f8 BD74133D 		.word	1024685245
 931 00fc 00000000 		.word	__int_reg
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 20


 932 0100 00002042 		.word	1109393408
 933 0104 FFFFA43C 		.word	1017446399
 934 0108 FFFF243D 		.word	1025835007
 935 010c 000000BC 		.word	-1140850688
 936 0110 6F12033D 		.word	1023611503
 937 0114 3333F33F 		.word	1072902963
 938 0118 0000F03F 		.word	1072693248
 939              		.cfi_endproc
 940              	.LFE245:
 942              		.section	.text.reset_foc,"ax",%progbits
 943              		.align	1
 944              		.global	reset_foc
 945              		.syntax unified
 946              		.thumb
 947              		.thumb_func
 949              	reset_foc:
 950              	.LVL75:
 951              	.LFB246:
 148:Core/Src/foc.c **** 
 149:Core/Src/foc.c **** void reset_foc(ControllerStruct *controller){
 952              		.loc 1 149 45 is_stmt 1 view -0
 953              		.cfi_startproc
 954              		@ args = 0, pretend = 0, frame = 0
 955              		@ frame_needed = 0, uses_anonymous_args = 0
 956              		@ link register save eliminated.
 150:Core/Src/foc.c **** 
 151:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR3 = ((TIM_PWM.Instance->ARR))*(0.5f);
 957              		.loc 1 151 2 view .LVU268
 958              		.loc 1 151 36 is_stmt 0 view .LVU269
 959 0000 1A4B     		ldr	r3, .L42
 960 0002 1B68     		ldr	r3, [r3]
 961              		.loc 1 151 45 view .LVU270
 962 0004 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 963              		.loc 1 151 52 view .LVU271
 964 0008 B8EE477A 		vcvt.f32.u32	s14, s14
 965 000c F6EE006A 		vmov.f32	s13, #5.0e-1
 966 0010 27EE267A 		vmul.f32	s14, s14, s13
 967              		.loc 1 151 25 view .LVU272
 968 0014 BCEEC77A 		vcvt.u32.f32	s14, s14
 969 0018 83ED0F7A 		vstr.32	s14, [r3, #60]	@ int
 152:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR1 = ((TIM_PWM.Instance->ARR))*(0.5f);
 970              		.loc 1 152 2 is_stmt 1 view .LVU273
 971              		.loc 1 152 45 is_stmt 0 view .LVU274
 972 001c 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 973              		.loc 1 152 52 view .LVU275
 974 0020 B8EE477A 		vcvt.f32.u32	s14, s14
 975 0024 27EE267A 		vmul.f32	s14, s14, s13
 976              		.loc 1 152 25 view .LVU276
 977 0028 BCEEC77A 		vcvt.u32.f32	s14, s14
 978 002c 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
 153:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR2 = ((TIM_PWM.Instance->ARR))*(0.5f);
 979              		.loc 1 153 2 is_stmt 1 view .LVU277
 980              		.loc 1 153 45 is_stmt 0 view .LVU278
 981 0030 D3ED0B7A 		vldr.32	s15, [r3, #44]	@ int
 982              		.loc 1 153 52 view .LVU279
 983 0034 F8EE677A 		vcvt.f32.u32	s15, s15
 984 0038 67EEA67A 		vmul.f32	s15, s15, s13
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 21


 985              		.loc 1 153 25 view .LVU280
 986 003c FCEEE77A 		vcvt.u32.f32	s15, s15
 987 0040 C3ED0E7A 		vstr.32	s15, [r3, #56]	@ int
 154:Core/Src/foc.c ****     controller->i_d_des = 0;
 988              		.loc 1 154 5 is_stmt 1 view .LVU281
 989              		.loc 1 154 25 is_stmt 0 view .LVU282
 990 0044 0023     		movs	r3, #0
 991 0046 C0F8AC30 		str	r3, [r0, #172]	@ float
 155:Core/Src/foc.c ****     controller->i_q_des = 0;
 992              		.loc 1 155 5 is_stmt 1 view .LVU283
 993              		.loc 1 155 25 is_stmt 0 view .LVU284
 994 004a C0F8B030 		str	r3, [r0, #176]	@ float
 156:Core/Src/foc.c ****     controller->i_d = 0;
 995              		.loc 1 156 5 is_stmt 1 view .LVU285
 996              		.loc 1 156 21 is_stmt 0 view .LVU286
 997 004e C363     		str	r3, [r0, #60]	@ float
 157:Core/Src/foc.c ****     controller->i_q = 0;
 998              		.loc 1 157 5 is_stmt 1 view .LVU287
 999              		.loc 1 157 21 is_stmt 0 view .LVU288
 1000 0050 0364     		str	r3, [r0, #64]	@ float
 158:Core/Src/foc.c ****     controller->i_q_filt = 0;
 1001              		.loc 1 158 5 is_stmt 1 view .LVU289
 1002              		.loc 1 158 26 is_stmt 0 view .LVU290
 1003 0052 4364     		str	r3, [r0, #68]	@ float
 159:Core/Src/foc.c ****     controller->q_int = 0;
 1004              		.loc 1 159 5 is_stmt 1 view .LVU291
 1005              		.loc 1 159 23 is_stmt 0 view .LVU292
 1006 0054 C0F89830 		str	r3, [r0, #152]	@ float
 160:Core/Src/foc.c ****     controller->d_int = 0;
 1007              		.loc 1 160 5 is_stmt 1 view .LVU293
 1008              		.loc 1 160 23 is_stmt 0 view .LVU294
 1009 0058 C0F89430 		str	r3, [r0, #148]	@ float
 161:Core/Src/foc.c ****     controller->v_q = 0;
 1010              		.loc 1 161 5 is_stmt 1 view .LVU295
 1011              		.loc 1 161 21 is_stmt 0 view .LVU296
 1012 005c 8365     		str	r3, [r0, #88]	@ float
 162:Core/Src/foc.c ****     controller->v_d = 0;
 1013              		.loc 1 162 5 is_stmt 1 view .LVU297
 1014              		.loc 1 162 21 is_stmt 0 view .LVU298
 1015 005e 4365     		str	r3, [r0, #84]	@ float
 163:Core/Src/foc.c ****     controller->fw_int = 0;
 1016              		.loc 1 163 5 is_stmt 1 view .LVU299
 1017              		.loc 1 163 24 is_stmt 0 view .LVU300
 1018 0060 C0F8F430 		str	r3, [r0, #244]	@ float
 164:Core/Src/foc.c ****     controller->otw_flag = 0;
 1019              		.loc 1 164 5 is_stmt 1 view .LVU301
 1020              		.loc 1 164 26 is_stmt 0 view .LVU302
 1021 0064 0023     		movs	r3, #0
 1022 0066 C0F8FC30 		str	r3, [r0, #252]
 165:Core/Src/foc.c **** 
 166:Core/Src/foc.c ****     }
 1023              		.loc 1 166 5 view .LVU303
 1024 006a 7047     		bx	lr
 1025              	.L43:
 1026              		.align	2
 1027              	.L42:
 1028 006c 00000000 		.word	htim1
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 22


 1029              		.cfi_endproc
 1030              	.LFE246:
 1032              		.section	.text.reset_observer,"ax",%progbits
 1033              		.align	1
 1034              		.global	reset_observer
 1035              		.syntax unified
 1036              		.thumb
 1037              		.thumb_func
 1039              	reset_observer:
 1040              	.LVL76:
 1041              	.LFB247:
 167:Core/Src/foc.c **** 
 168:Core/Src/foc.c **** void reset_observer(ObserverStruct *observer){
 1042              		.loc 1 168 46 is_stmt 1 view -0
 1043              		.cfi_startproc
 1044              		@ args = 0, pretend = 0, frame = 0
 1045              		@ frame_needed = 0, uses_anonymous_args = 0
 1046              		@ link register save eliminated.
 169:Core/Src/foc.c **** /*
 170:Core/Src/foc.c ****     observer->temperature = 25.0f;
 171:Core/Src/foc.c ****     observer->temp_measured = 25.0f;
 172:Core/Src/foc.c ****     //observer->resistance = .1f;
 173:Core/Src/foc.c **** */
 174:Core/Src/foc.c **** }
 1047              		.loc 1 174 1 view .LVU305
 1048 0000 7047     		bx	lr
 1049              		.cfi_endproc
 1050              	.LFE247:
 1052              		.section	.text.update_observer,"ax",%progbits
 1053              		.align	1
 1054              		.global	update_observer
 1055              		.syntax unified
 1056              		.thumb
 1057              		.thumb_func
 1059              	update_observer:
 1060              	.LVL77:
 1061              	.LFB248:
 175:Core/Src/foc.c **** 
 176:Core/Src/foc.c **** void update_observer(ControllerStruct *controller, ObserverStruct *observer)
 177:Core/Src/foc.c **** {
 1062              		.loc 1 177 1 view -0
 1063              		.cfi_startproc
 1064              		@ args = 0, pretend = 0, frame = 0
 1065              		@ frame_needed = 0, uses_anonymous_args = 0
 1066              		@ link register save eliminated.
 178:Core/Src/foc.c **** 	/*
 179:Core/Src/foc.c ****     /// Update observer estimates ///
 180:Core/Src/foc.c ****     // Resistance observer //
 181:Core/Src/foc.c ****     // Temperature Observer //
 182:Core/Src/foc.c ****     observer->delta_t = (float)observer->temperature - T_AMBIENT;
 183:Core/Src/foc.c ****     float i_sq = controller->i_d*controller->i_d + controller->i_q*controller->i_q;
 184:Core/Src/foc.c ****     observer->q_in = (R_NOMINAL*1.5f)*(1.0f + .00393f*observer->delta_t)*i_sq;
 185:Core/Src/foc.c ****     observer->q_out = observer->delta_t*R_TH;
 186:Core/Src/foc.c ****     observer->temperature += (INV_M_TH*DT)*(observer->q_in-observer->q_out);
 187:Core/Src/foc.c **** 
 188:Core/Src/foc.c ****     //float r_d = (controller->v_d*(DTC_MAX-DTC_MIN) + SQRT3*controller->dtheta_elec*(L_Q*controlle
 189:Core/Src/foc.c ****     float r_q = (controller->v_q*(DTC_MAX-DTC_MIN) - SQRT3*controller->dtheta_elec*(L_D*controller-
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 23


 190:Core/Src/foc.c ****     observer->resistance = r_q;//(r_d*controller->i_d + r_q*controller->i_q)/(controller->i_d + con
 191:Core/Src/foc.c **** 
 192:Core/Src/foc.c ****     //observer->resistance = controller->v_q/controller->i_q;
 193:Core/Src/foc.c ****     if(isnan(observer->resistance) || isinf(observer->resistance)){observer->resistance = R_NOMINAL
 194:Core/Src/foc.c ****     float t_raw = ((T_AMBIENT + ((observer->resistance/R_NOMINAL) - 1.0f)*254.5f));
 195:Core/Src/foc.c ****     if(t_raw > 200.0f){t_raw = 200.0f;}
 196:Core/Src/foc.c ****     else if(t_raw < 0.0f){t_raw = 0.0f;}
 197:Core/Src/foc.c ****     observer->temp_measured = .999f*observer->temp_measured + .001f*t_raw;
 198:Core/Src/foc.c ****     float e = (float)observer->temperature - observer->temp_measured;
 199:Core/Src/foc.c ****     observer->trust = (1.0f - .004f*fminf(abs(controller->dtheta_elec), 250.0f)) * (.01f*(fminf(i_s
 200:Core/Src/foc.c ****     observer->temperature -= observer->trust*.0001f*e;
 201:Core/Src/foc.c ****     //printf("%.3f\n\r", e);
 202:Core/Src/foc.c **** 
 203:Core/Src/foc.c ****     if(observer->temperature > TEMP_MAX){controller->otw_flag = 1;}
 204:Core/Src/foc.c ****     else{controller->otw_flag = 0;}
 205:Core/Src/foc.c ****     */
 206:Core/Src/foc.c **** }
 1067              		.loc 1 206 1 view .LVU307
 1068 0000 7047     		bx	lr
 1069              		.cfi_endproc
 1070              	.LFE248:
 1072              		.section	.text.linearize_dtc,"ax",%progbits
 1073              		.align	1
 1074              		.global	linearize_dtc
 1075              		.syntax unified
 1076              		.thumb
 1077              		.thumb_func
 1079              	linearize_dtc:
 1080              	.LVL78:
 1081              	.LFB249:
 207:Core/Src/foc.c **** 
 208:Core/Src/foc.c **** float linearize_dtc(ControllerStruct *controller, float dtc)
 209:Core/Src/foc.c **** {
 1082              		.loc 1 209 1 view -0
 1083              		.cfi_startproc
 1084              		@ args = 0, pretend = 0, frame = 0
 1085              		@ frame_needed = 0, uses_anonymous_args = 0
 1086              		.loc 1 209 1 is_stmt 0 view .LVU309
 1087 0000 10B5     		push	{r4, lr}
 1088              		.cfi_def_cfa_offset 8
 1089              		.cfi_offset 4, -8
 1090              		.cfi_offset 14, -4
 1091 0002 0446     		mov	r4, r0
 210:Core/Src/foc.c ****     float duty = fast_fmaxf(fast_fminf(fabs(dtc), .999f), 0.0f);;
 1092              		.loc 1 210 5 is_stmt 1 view .LVU310
 1093              		.loc 1 210 18 is_stmt 0 view .LVU311
 1094 0004 DFED170A 		vldr.32	s1, .L48
 1095 0008 B0EEC00A 		vabs.f32	s0, s0
 1096              	.LVL79:
 1097              		.loc 1 210 18 view .LVU312
 1098 000c FFF7FEFF 		bl	fast_fminf
 1099              	.LVL80:
 1100              		.loc 1 210 18 view .LVU313
 1101 0010 DFED150A 		vldr.32	s1, .L48+4
 1102 0014 FFF7FEFF 		bl	fast_fmaxf
 1103              	.LVL81:
 1104              		.loc 1 210 65 is_stmt 1 view .LVU314
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 24


 211:Core/Src/foc.c ****     int index = (int) (duty*127.0f);
 1105              		.loc 1 211 5 view .LVU315
 1106              		.loc 1 211 28 is_stmt 0 view .LVU316
 1107 0018 DFED147A 		vldr.32	s15, .L48+8
 1108 001c 60EE277A 		vmul.f32	s15, s0, s15
 1109              		.loc 1 211 9 view .LVU317
 1110 0020 FDEEE77A 		vcvt.s32.f32	s15, s15
 1111 0024 17EE903A 		vmov	r3, s15	@ int
 1112              	.LVL82:
 212:Core/Src/foc.c ****     float val1 = controller->inverter_tab[index];
 1113              		.loc 1 212 5 is_stmt 1 view .LVU318
 1114              		.loc 1 212 11 is_stmt 0 view .LVU319
 1115 0028 03F14002 		add	r2, r3, #64
 1116 002c 04EB8202 		add	r2, r4, r2, lsl #2
 1117 0030 D2ED016A 		vldr.32	s13, [r2, #4]
 1118              	.LVL83:
 213:Core/Src/foc.c ****     float val2 = controller->inverter_tab[index+1];
 1119              		.loc 1 213 5 is_stmt 1 view .LVU320
 1120              		.loc 1 213 11 is_stmt 0 view .LVU321
 1121 0034 03F14100 		add	r0, r3, #65
 1122 0038 04EB8004 		add	r4, r4, r0, lsl #2
 1123              	.LVL84:
 1124              		.loc 1 213 11 view .LVU322
 1125 003c D4ED017A 		vldr.32	s15, [r4, #4]
 1126              	.LVL85:
 214:Core/Src/foc.c ****     return val1 + (val2 - val1)*(duty*128.0f - (float)index);
 1127              		.loc 1 214 5 is_stmt 1 view .LVU323
 1128              		.loc 1 214 25 is_stmt 0 view .LVU324
 1129 0040 37EEE67A 		vsub.f32	s14, s15, s13
 1130              		.loc 1 214 38 view .LVU325
 1131 0044 DFED0A7A 		vldr.32	s15, .L48+12
 1132              	.LVL86:
 1133              		.loc 1 214 38 view .LVU326
 1134 0048 20EE270A 		vmul.f32	s0, s0, s15
 1135              	.LVL87:
 1136              		.loc 1 214 48 view .LVU327
 1137 004c 07EE903A 		vmov	s15, r3	@ int
 1138 0050 F8EEE77A 		vcvt.f32.s32	s15, s15
 1139              		.loc 1 214 46 view .LVU328
 1140 0054 70EE677A 		vsub.f32	s15, s0, s15
 1141              		.loc 1 214 32 view .LVU329
 1142 0058 67EE277A 		vmul.f32	s15, s14, s15
 215:Core/Src/foc.c **** }
 1143              		.loc 1 215 1 view .LVU330
 1144 005c 37EEA60A 		vadd.f32	s0, s15, s13
 1145 0060 10BD     		pop	{r4, pc}
 1146              	.LVL88:
 1147              	.L49:
 1148              		.loc 1 215 1 view .LVU331
 1149 0062 00BF     		.align	2
 1150              	.L48:
 1151 0064 77BE7F3F 		.word	1065336439
 1152 0068 00000000 		.word	0
 1153 006c 0000FE42 		.word	1123942400
 1154 0070 00000043 		.word	1124073472
 1155              		.cfi_endproc
 1156              	.LFE249:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 25


 1158              		.section	.text.field_weaken,"ax",%progbits
 1159              		.align	1
 1160              		.global	field_weaken
 1161              		.syntax unified
 1162              		.thumb
 1163              		.thumb_func
 1165              	field_weaken:
 1166              	.LVL89:
 1167              	.LFB250:
 216:Core/Src/foc.c **** 
 217:Core/Src/foc.c **** void field_weaken(ControllerStruct *controller)
 218:Core/Src/foc.c **** {
 1168              		.loc 1 218 1 is_stmt 1 view -0
 1169              		.cfi_startproc
 1170              		@ args = 0, pretend = 0, frame = 0
 1171              		@ frame_needed = 0, uses_anonymous_args = 0
 1172              		.loc 1 218 1 is_stmt 0 view .LVU333
 1173 0000 10B5     		push	{r4, lr}
 1174              		.cfi_def_cfa_offset 8
 1175              		.cfi_offset 4, -8
 1176              		.cfi_offset 14, -4
 1177 0002 2DED028B 		vpush.64	{d8}
 1178              		.cfi_def_cfa_offset 16
 1179              		.cfi_offset 80, -16
 1180              		.cfi_offset 81, -12
 1181 0006 0446     		mov	r4, r0
 219:Core/Src/foc.c ****        /// Field Weakening ///
 220:Core/Src/foc.c **** 
 221:Core/Src/foc.c ****        controller->fw_int += controller->ki_fw*(controller->v_max - 1.0f - controller->v_ref);
 1182              		.loc 1 221 8 is_stmt 1 view .LVU334
 1183              		.loc 1 221 40 is_stmt 0 view .LVU335
 1184 0008 90ED220A 		vldr.32	s0, [r0, #136]
 1185              		.loc 1 221 59 view .LVU336
 1186 000c D0ED3B7A 		vldr.32	s15, [r0, #236]
 1187              		.loc 1 221 67 view .LVU337
 1188 0010 B7EE007A 		vmov.f32	s14, #1.0e+0
 1189 0014 77EEC77A 		vsub.f32	s15, s15, s14
 1190              		.loc 1 221 86 view .LVU338
 1191 0018 90ED3C7A 		vldr.32	s14, [r0, #240]
 1192              		.loc 1 221 74 view .LVU339
 1193 001c 77EEC77A 		vsub.f32	s15, s15, s14
 1194              		.loc 1 221 47 view .LVU340
 1195 0020 20EE270A 		vmul.f32	s0, s0, s15
 1196              		.loc 1 221 27 view .LVU341
 1197 0024 D0ED3D7A 		vldr.32	s15, [r0, #244]
 1198 0028 30EE270A 		vadd.f32	s0, s0, s15
 1199 002c 80ED3D0A 		vstr.32	s0, [r0, #244]
 222:Core/Src/foc.c ****        controller->fw_int = fast_fmaxf(fast_fminf(controller->fw_int, 0.0f), -I_FW_MAX);
 1200              		.loc 1 222 8 is_stmt 1 view .LVU342
 1201              		.loc 1 222 29 is_stmt 0 view .LVU343
 1202 0030 DFED240A 		vldr.32	s1, .L63
 1203 0034 FFF7FEFF 		bl	fast_fminf
 1204              	.LVL90:
 1205              		.loc 1 222 79 view .LVU344
 1206 0038 234B     		ldr	r3, .L63+4
 1207 003a D3ED060A 		vldr.32	s1, [r3, #24]
 1208              		.loc 1 222 29 view .LVU345
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 26


 1209 003e F1EE600A 		vneg.f32	s1, s1
 1210 0042 FFF7FEFF 		bl	fast_fmaxf
 1211              	.LVL91:
 1212              		.loc 1 222 27 view .LVU346
 1213 0046 84ED3D0A 		vstr.32	s0, [r4, #244]
 223:Core/Src/foc.c ****        controller->i_q_des = controller->i_q_des + (controller->i_q_des > 0)*controller->fw_int + (
 1214              		.loc 1 223 8 is_stmt 1 view .LVU347
 1215              		.loc 1 223 40 is_stmt 0 view .LVU348
 1216 004a 94ED2C7A 		vldr.32	s14, [r4, #176]
 1217              		.loc 1 223 77 view .LVU349
 1218 004e B5EEC07A 		vcmpe.f32	s14, #0
 1219 0052 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1220 0056 2FDD     		ble	.L59
 1221 0058 F7EE007A 		vmov.f32	s15, #1.0e+0
 1222              	.L51:
 1223              		.loc 1 223 77 discriminator 4 view .LVU350
 1224 005c 60EE277A 		vmul.f32	s15, s0, s15
 1225              		.loc 1 223 50 discriminator 4 view .LVU351
 1226 0060 77EE277A 		vadd.f32	s15, s14, s15
 1227              		.loc 1 223 124 discriminator 4 view .LVU352
 1228 0064 B5EEC07A 		vcmpe.f32	s14, #0
 1229 0068 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1230 006c 27D4     		bmi	.L62
 1231              		.loc 1 223 124 view .LVU353
 1232 006e 9FED157A 		vldr.32	s14, .L63
 1233              	.L53:
 1234              		.loc 1 223 124 discriminator 8 view .LVU354
 1235 0072 20EE077A 		vmul.f32	s14, s0, s14
 1236              		.loc 1 223 97 discriminator 8 view .LVU355
 1237 0076 77EE877A 		vadd.f32	s15, s15, s14
 1238              		.loc 1 223 28 discriminator 8 view .LVU356
 1239 007a C4ED2C7A 		vstr.32	s15, [r4, #176]
 224:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1240              		.loc 1 224 8 is_stmt 1 discriminator 8 view .LVU357
 1241              		.loc 1 224 28 is_stmt 0 discriminator 8 view .LVU358
 1242 007e 84ED2B0A 		vstr.32	s0, [r4, #172]
 225:Core/Src/foc.c ****        float q_max = sqrtf(controller->i_max*controller->i_max - controller->i_d_des*controller->i_
 1243              		.loc 1 225 8 is_stmt 1 discriminator 8 view .LVU359
 1244              		.loc 1 225 38 is_stmt 0 discriminator 8 view .LVU360
 1245 0082 D4ED407A 		vldr.32	s15, [r4, #256]
 1246              		.loc 1 225 45 discriminator 8 view .LVU361
 1247 0086 67EEA77A 		vmul.f32	s15, s15, s15
 1248              		.loc 1 225 85 discriminator 8 view .LVU362
 1249 008a 20EE000A 		vmul.f32	s0, s0, s0
 1250              		.loc 1 225 22 discriminator 8 view .LVU363
 1251 008e 37EEC00A 		vsub.f32	s0, s15, s0
 1252 0092 FFF7FEFF 		bl	sqrtf
 1253              	.LVL92:
 1254 0096 B0EE408A 		vmov.f32	s16, s0
 1255              	.LVL93:
 226:Core/Src/foc.c ****        controller->i_q_des = fast_fmaxf(fast_fminf(controller->i_q_des, q_max), -q_max);
 1256              		.loc 1 226 8 is_stmt 1 discriminator 8 view .LVU364
 1257              		.loc 1 226 30 is_stmt 0 discriminator 8 view .LVU365
 1258 009a F0EE400A 		vmov.f32	s1, s0
 1259 009e 94ED2C0A 		vldr.32	s0, [r4, #176]
 1260              	.LVL94:
 1261              		.loc 1 226 30 discriminator 8 view .LVU366
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 27


 1262 00a2 FFF7FEFF 		bl	fast_fminf
 1263              	.LVL95:
 1264              		.loc 1 226 30 discriminator 8 view .LVU367
 1265 00a6 F1EE480A 		vneg.f32	s1, s16
 1266 00aa FFF7FEFF 		bl	fast_fmaxf
 1267              	.LVL96:
 1268              		.loc 1 226 28 discriminator 8 view .LVU368
 1269 00ae 84ED2C0A 		vstr.32	s0, [r4, #176]
 227:Core/Src/foc.c **** 
 228:Core/Src/foc.c **** 
 229:Core/Src/foc.c **** }
 1270              		.loc 1 229 1 discriminator 8 view .LVU369
 1271 00b2 BDEC028B 		vldm	sp!, {d8}
 1272              		.cfi_remember_state
 1273              		.cfi_restore 80
 1274              		.cfi_restore 81
 1275              		.cfi_def_cfa_offset 8
 1276              	.LVL97:
 1277              		.loc 1 229 1 discriminator 8 view .LVU370
 1278 00b6 10BD     		pop	{r4, pc}
 1279              	.LVL98:
 1280              	.L59:
 1281              		.cfi_restore_state
 223:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1282              		.loc 1 223 77 view .LVU371
 1283 00b8 DFED027A 		vldr.32	s15, .L63
 1284 00bc CEE7     		b	.L51
 1285              	.L62:
 223:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1286              		.loc 1 223 124 view .LVU372
 1287 00be B7EE007A 		vmov.f32	s14, #1.0e+0
 1288 00c2 D6E7     		b	.L53
 1289              	.L64:
 1290              		.align	2
 1291              	.L63:
 1292 00c4 00000000 		.word	0
 1293 00c8 00000000 		.word	__float_reg
 1294              		.cfi_endproc
 1295              	.LFE250:
 1297              		.section	.text.commutate,"ax",%progbits
 1298              		.align	1
 1299              		.global	commutate
 1300              		.syntax unified
 1301              		.thumb
 1302              		.thumb_func
 1304              	commutate:
 1305              	.LVL99:
 1306              	.LFB251:
 230:Core/Src/foc.c **** void commutate(ControllerStruct *controller, EncoderStruct *encoder)//电流环 控制
 231:Core/Src/foc.c **** {
 1307              		.loc 1 231 1 is_stmt 1 view -0
 1308              		.cfi_startproc
 1309              		@ args = 0, pretend = 0, frame = 0
 1310              		@ frame_needed = 0, uses_anonymous_args = 0
 1311              		.loc 1 231 1 is_stmt 0 view .LVU374
 1312 0000 38B5     		push	{r3, r4, r5, lr}
 1313              		.cfi_def_cfa_offset 16
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 28


 1314              		.cfi_offset 3, -16
 1315              		.cfi_offset 4, -12
 1316              		.cfi_offset 5, -8
 1317              		.cfi_offset 14, -4
 1318 0002 2DED048B 		vpush.64	{d8, d9}
 1319              		.cfi_def_cfa_offset 32
 1320              		.cfi_offset 80, -32
 1321              		.cfi_offset 81, -28
 1322              		.cfi_offset 82, -24
 1323              		.cfi_offset 83, -20
 1324 0006 0446     		mov	r4, r0
 232:Core/Src/foc.c **** 	/* Do Field Oriented Control */
 233:Core/Src/foc.c **** 
 234:Core/Src/foc.c **** 		controller->theta_elec = encoder->elec_angle;
 1325              		.loc 1 234 3 is_stmt 1 view .LVU375
 1326              		.loc 1 234 35 is_stmt 0 view .LVU376
 1327 0008 91ED170A 		vldr.32	s0, [r1, #92]
 1328              		.loc 1 234 26 view .LVU377
 1329 000c 80ED0B0A 		vstr.32	s0, [r0, #44]
 235:Core/Src/foc.c **** 		controller->dtheta_elec = encoder->elec_velocity;
 1330              		.loc 1 235 3 is_stmt 1 view .LVU378
 1331              		.loc 1 235 36 is_stmt 0 view .LVU379
 1332 0010 4B6E     		ldr	r3, [r1, #100]	@ float
 1333              		.loc 1 235 27 view .LVU380
 1334 0012 4363     		str	r3, [r0, #52]	@ float
 236:Core/Src/foc.c **** 		controller->dtheta_mech = encoder->velocity/GR;
 1335              		.loc 1 236 3 is_stmt 1 view .LVU381
 1336              		.loc 1 236 36 is_stmt 0 view .LVU382
 1337 0014 D1ED186A 		vldr.32	s13, [r1, #96]
 1338              		.loc 1 236 47 view .LVU383
 1339 0018 8B4D     		ldr	r5, .L70
 1340 001a 95ED117A 		vldr.32	s14, [r5, #68]
 1341              		.loc 1 236 46 view .LVU384
 1342 001e C6EE877A 		vdiv.f32	s15, s13, s14
 1343              		.loc 1 236 27 view .LVU385
 1344 0022 C0ED0C7A 		vstr.32	s15, [r0, #48]
 237:Core/Src/foc.c **** 		controller->theta_mech = encoder->angle_multiturn[0]/GR;
 1345              		.loc 1 237 3 is_stmt 1 view .LVU386
 1346              		.loc 1 237 52 is_stmt 0 view .LVU387
 1347 0026 D1ED036A 		vldr.32	s13, [r1, #12]
 1348              		.loc 1 237 56 view .LVU388
 1349 002a 95ED117A 		vldr.32	s14, [r5, #68]
 1350              		.loc 1 237 55 view .LVU389
 1351 002e C6EE877A 		vdiv.f32	s15, s13, s14
 1352              		.loc 1 237 26 view .LVU390
 1353 0032 C0ED0A7A 		vstr.32	s15, [r0, #40]
 238:Core/Src/foc.c **** 
 239:Core/Src/foc.c ****        /// Commutation  ///
 240:Core/Src/foc.c ****        dq0(controller->theta_elec, controller->i_a, controller->i_b, controller->i_c, &controller->
 1354              		.loc 1 240 8 is_stmt 1 view .LVU391
 1355 0036 00F14001 		add	r1, r0, #64
 1356              	.LVL100:
 1357              		.loc 1 240 8 is_stmt 0 view .LVU392
 1358 003a 3C30     		adds	r0, r0, #60
 1359              	.LVL101:
 1360              		.loc 1 240 8 view .LVU393
 1361 003c D4ED071A 		vldr.32	s3, [r4, #28]
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 29


 1362 0040 94ED061A 		vldr.32	s2, [r4, #24]
 1363 0044 D4ED050A 		vldr.32	s1, [r4, #20]
 1364 0048 FFF7FEFF 		bl	dq0
 1365              	.LVL102:
 241:Core/Src/foc.c **** 
 242:Core/Src/foc.c ****        controller->i_q_filt = (1.0f-CURRENT_FILT_ALPHA)*controller->i_q_filt + CURRENT_FILT_ALPHA*c
 1366              		.loc 1 242 8 is_stmt 1 view .LVU394
 1367              		.loc 1 242 67 is_stmt 0 view .LVU395
 1368 004c 94ED117A 		vldr.32	s14, [r4, #68]
 1369              		.loc 1 242 56 view .LVU396
 1370 0050 9FED7E6A 		vldr.32	s12, .L70+4
 1371 0054 27EE067A 		vmul.f32	s14, s14, s12
 1372              		.loc 1 242 109 view .LVU397
 1373 0058 D4ED107A 		vldr.32	s15, [r4, #64]
 1374              		.loc 1 242 98 view .LVU398
 1375 005c DFED7C6A 		vldr.32	s13, .L70+8
 1376 0060 67EEA67A 		vmul.f32	s15, s15, s13
 1377              		.loc 1 242 78 view .LVU399
 1378 0064 37EE277A 		vadd.f32	s14, s14, s15
 1379              		.loc 1 242 29 view .LVU400
 1380 0068 84ED117A 		vstr.32	s14, [r4, #68]
 243:Core/Src/foc.c ****        controller->i_d_filt = (1.0f-CURRENT_FILT_ALPHA)*controller->i_d_filt + CURRENT_FILT_ALPHA*c
 1381              		.loc 1 243 8 is_stmt 1 view .LVU401
 1382              		.loc 1 243 67 is_stmt 0 view .LVU402
 1383 006c 94ED127A 		vldr.32	s14, [r4, #72]
 1384              		.loc 1 243 56 view .LVU403
 1385 0070 27EE067A 		vmul.f32	s14, s14, s12
 1386              		.loc 1 243 109 view .LVU404
 1387 0074 D4ED0F7A 		vldr.32	s15, [r4, #60]
 1388              		.loc 1 243 98 view .LVU405
 1389 0078 67EEA67A 		vmul.f32	s15, s15, s13
 1390              		.loc 1 243 78 view .LVU406
 1391 007c 37EE277A 		vadd.f32	s14, s14, s15
 1392              		.loc 1 243 29 view .LVU407
 1393 0080 84ED127A 		vstr.32	s14, [r4, #72]
 244:Core/Src/foc.c ****        controller->v_bus_filt = (1.0f-VBUS_FILT_ALPHA)*controller->v_bus_filt + VBUS_FILT_ALPHA*con
 1394              		.loc 1 244 8 is_stmt 1 view .LVU408
 1395              		.loc 1 244 66 is_stmt 0 view .LVU409
 1396 0084 D4ED097A 		vldr.32	s15, [r4, #36]
 1397              		.loc 1 244 55 view .LVU410
 1398 0088 67EE867A 		vmul.f32	s15, s15, s12
 1399              		.loc 1 244 107 view .LVU411
 1400 008c 94ED087A 		vldr.32	s14, [r4, #32]
 1401              		.loc 1 244 96 view .LVU412
 1402 0090 27EE267A 		vmul.f32	s14, s14, s13
 1403              		.loc 1 244 79 view .LVU413
 1404 0094 77EE877A 		vadd.f32	s15, s15, s14
 1405              		.loc 1 244 31 view .LVU414
 1406 0098 C4ED097A 		vstr.32	s15, [r4, #36]
 245:Core/Src/foc.c **** 
 246:Core/Src/foc.c ****        controller->v_max = OVERMODULATION*controller->v_bus_filt*(DTC_MAX-DTC_MIN)*SQRT1_3;
 1407              		.loc 1 246 8 is_stmt 1 view .LVU415
 1408              		.loc 1 246 65 is_stmt 0 view .LVU416
 1409 009c 9FED6D7A 		vldr.32	s14, .L70+12
 1410 00a0 67EE877A 		vmul.f32	s15, s15, s14
 1411              		.loc 1 246 83 view .LVU417
 1412 00a4 9FED6C7A 		vldr.32	s14, .L70+16
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 30


 1413 00a8 67EE877A 		vmul.f32	s15, s15, s14
 1414              		.loc 1 246 26 view .LVU418
 1415 00ac C4ED3B7A 		vstr.32	s15, [r4, #236]
 247:Core/Src/foc.c ****        controller->v_margin = controller->v_max - controller->v_ref;
 1416              		.loc 1 247 8 is_stmt 1 view .LVU419
 1417              		.loc 1 247 61 is_stmt 0 view .LVU420
 1418 00b0 94ED3C7A 		vldr.32	s14, [r4, #240]
 1419              		.loc 1 247 49 view .LVU421
 1420 00b4 77EEC77A 		vsub.f32	s15, s15, s14
 1421              		.loc 1 247 29 view .LVU422
 1422 00b8 C4ED3E7A 		vstr.32	s15, [r4, #248]
 248:Core/Src/foc.c ****        controller->i_max = I_MAX; //I_MAX*(!controller->otw_flag) + I_MAX_CONT*controller->otw_flag
 1423              		.loc 1 248 8 is_stmt 1 view .LVU423
 1424              		.loc 1 248 28 is_stmt 0 view .LVU424
 1425 00bc 95ED030A 		vldr.32	s0, [r5, #12]
 1426              		.loc 1 248 26 view .LVU425
 1427 00c0 84ED400A 		vstr.32	s0, [r4, #256]
 249:Core/Src/foc.c **** 
 250:Core/Src/foc.c ****        limit_norm(&controller->i_d_des, &controller->i_q_des, controller->i_max);	// 2.3 us
 1428              		.loc 1 250 8 is_stmt 1 view .LVU426
 1429 00c4 04F1B001 		add	r1, r4, #176
 1430 00c8 04F1AC00 		add	r0, r4, #172
 1431 00cc FFF7FEFF 		bl	limit_norm
 1432              	.LVL103:
 251:Core/Src/foc.c **** 
 252:Core/Src/foc.c ****        /// PI Controller ///
 253:Core/Src/foc.c ****        float i_d_error = controller->i_d_des - controller->i_d;
 1433              		.loc 1 253 8 view .LVU427
 1434              		.loc 1 253 36 is_stmt 0 view .LVU428
 1435 00d0 94ED2B0A 		vldr.32	s0, [r4, #172]
 1436              		.loc 1 253 58 view .LVU429
 1437 00d4 D4ED0F8A 		vldr.32	s17, [r4, #60]
 1438              		.loc 1 253 14 view .LVU430
 1439 00d8 70EE688A 		vsub.f32	s17, s0, s17
 1440              	.LVL104:
 254:Core/Src/foc.c ****        float i_q_error = controller->i_q_des - controller->i_q;
 1441              		.loc 1 254 8 is_stmt 1 view .LVU431
 1442              		.loc 1 254 36 is_stmt 0 view .LVU432
 1443 00dc D4ED2C7A 		vldr.32	s15, [r4, #176]
 1444              		.loc 1 254 58 view .LVU433
 1445 00e0 94ED107A 		vldr.32	s14, [r4, #64]
 1446              		.loc 1 254 14 view .LVU434
 1447 00e4 37EEC78A 		vsub.f32	s16, s15, s14
 1448              	.LVL105:
 255:Core/Src/foc.c **** 
 256:Core/Src/foc.c ****        if(controller->i_q > controller->i_mag_max){
 1449              		.loc 1 256 8 is_stmt 1 view .LVU435
 1450              		.loc 1 256 39 is_stmt 0 view .LVU436
 1451 00e8 D4ED147A 		vldr.32	s15, [r4, #80]
 1452              		.loc 1 256 10 view .LVU437
 1453 00ec B4EEE77A 		vcmpe.f32	s14, s15
 1454 00f0 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1455 00f4 01DD     		ble	.L66
 257:Core/Src/foc.c ****     	   controller->i_mag_max = controller->i_q;
 1456              		.loc 1 257 9 is_stmt 1 view .LVU438
 1457              		.loc 1 257 31 is_stmt 0 view .LVU439
 1458 00f6 84ED147A 		vstr.32	s14, [r4, #80]
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 31


 1459              	.L66:
 258:Core/Src/foc.c ****        }
 259:Core/Src/foc.c **** 
 260:Core/Src/foc.c **** 
 261:Core/Src/foc.c ****        // Calculate decoupling feed-forward voltages //
 262:Core/Src/foc.c **** 
 263:Core/Src/foc.c ****        float v_d_ff = 0.0f;//-SQRT3*controller->dtheta_elec*L_Q*controller->i_q;
 1460              		.loc 1 263 8 is_stmt 1 view .LVU440
 1461              	.LVL106:
 264:Core/Src/foc.c ****        float v_q_ff = 0.0f;//SQRT3*controller->dtheta_elec*(0.0f*L_D*controller->i_d + controller->
 1462              		.loc 1 264 8 view .LVU441
 265:Core/Src/foc.c **** 
 266:Core/Src/foc.c ****        controller->v_d = controller->k_d*i_d_error + controller->d_int + v_d_ff;
 1463              		.loc 1 266 8 view .LVU442
 1464              		.loc 1 266 36 is_stmt 0 view .LVU443
 1465 00fa 94ED1E0A 		vldr.32	s0, [r4, #120]
 1466              		.loc 1 266 41 view .LVU444
 1467 00fe 20EE280A 		vmul.f32	s0, s0, s17
 1468              		.loc 1 266 64 view .LVU445
 1469 0102 D4ED257A 		vldr.32	s15, [r4, #148]
 1470              		.loc 1 266 52 view .LVU446
 1471 0106 30EE270A 		vadd.f32	s0, s0, s15
 1472              		.loc 1 266 72 view .LVU447
 1473 010a 9FED549A 		vldr.32	s18, .L70+20
 1474 010e 30EE090A 		vadd.f32	s0, s0, s18
 1475              		.loc 1 266 24 view .LVU448
 1476 0112 84ED150A 		vstr.32	s0, [r4, #84]
 267:Core/Src/foc.c **** 
 268:Core/Src/foc.c ****        controller->v_d = fast_fmaxf(fast_fminf(controller->v_d, controller->v_max), -controller->v_
 1477              		.loc 1 268 8 is_stmt 1 view .LVU449
 1478              		.loc 1 268 26 is_stmt 0 view .LVU450
 1479 0116 D4ED3B0A 		vldr.32	s1, [r4, #236]
 1480 011a FFF7FEFF 		bl	fast_fminf
 1481              	.LVL107:
 1482              		.loc 1 268 96 view .LVU451
 1483 011e D4ED3B0A 		vldr.32	s1, [r4, #236]
 1484              		.loc 1 268 26 view .LVU452
 1485 0122 F1EE600A 		vneg.f32	s1, s1
 1486 0126 FFF7FEFF 		bl	fast_fmaxf
 1487              	.LVL108:
 1488              		.loc 1 268 24 view .LVU453
 1489 012a 84ED150A 		vstr.32	s0, [r4, #84]
 269:Core/Src/foc.c **** 
 270:Core/Src/foc.c ****        controller->d_int += controller->k_d*controller->ki_d*i_d_error;
 1490              		.loc 1 270 8 is_stmt 1 view .LVU454
 1491              		.loc 1 270 39 is_stmt 0 view .LVU455
 1492 012e 94ED1E0A 		vldr.32	s0, [r4, #120]
 1493              		.loc 1 270 55 view .LVU456
 1494 0132 D4ED207A 		vldr.32	s15, [r4, #128]
 1495              		.loc 1 270 44 view .LVU457
 1496 0136 20EE270A 		vmul.f32	s0, s0, s15
 1497              		.loc 1 270 61 view .LVU458
 1498 013a 20EE280A 		vmul.f32	s0, s0, s17
 1499              		.loc 1 270 26 view .LVU459
 1500 013e D4ED257A 		vldr.32	s15, [r4, #148]
 1501 0142 30EE270A 		vadd.f32	s0, s0, s15
 1502 0146 84ED250A 		vstr.32	s0, [r4, #148]
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 32


 271:Core/Src/foc.c ****        controller->d_int = fast_fmaxf(fast_fminf(controller->d_int, controller->v_max), -controller
 1503              		.loc 1 271 8 is_stmt 1 view .LVU460
 1504              		.loc 1 271 28 is_stmt 0 view .LVU461
 1505 014a D4ED3B0A 		vldr.32	s1, [r4, #236]
 1506 014e FFF7FEFF 		bl	fast_fminf
 1507              	.LVL109:
 1508              		.loc 1 271 100 view .LVU462
 1509 0152 D4ED3B0A 		vldr.32	s1, [r4, #236]
 1510              		.loc 1 271 28 view .LVU463
 1511 0156 F1EE600A 		vneg.f32	s1, s1
 1512 015a FFF7FEFF 		bl	fast_fmaxf
 1513              	.LVL110:
 1514              		.loc 1 271 26 view .LVU464
 1515 015e 84ED250A 		vstr.32	s0, [r4, #148]
 272:Core/Src/foc.c ****        float vq_max = controller->v_max;//sqrtf(controller->v_max*controller->v_max - controller->v
 1516              		.loc 1 272 8 is_stmt 1 view .LVU465
 1517              		.loc 1 272 14 is_stmt 0 view .LVU466
 1518 0162 D4ED3B8A 		vldr.32	s17, [r4, #236]
 1519              	.LVL111:
 273:Core/Src/foc.c **** 
 274:Core/Src/foc.c ****        controller->v_q = controller->k_q*i_q_error + controller->q_int + v_q_ff;
 1520              		.loc 1 274 8 is_stmt 1 view .LVU467
 1521              		.loc 1 274 36 is_stmt 0 view .LVU468
 1522 0166 D4ED1F7A 		vldr.32	s15, [r4, #124]
 1523              		.loc 1 274 41 view .LVU469
 1524 016a 27EE887A 		vmul.f32	s14, s15, s16
 1525              		.loc 1 274 64 view .LVU470
 1526 016e 94ED260A 		vldr.32	s0, [r4, #152]
 1527              		.loc 1 274 52 view .LVU471
 1528 0172 37EE007A 		vadd.f32	s14, s14, s0
 1529              		.loc 1 274 72 view .LVU472
 1530 0176 37EE097A 		vadd.f32	s14, s14, s18
 1531              		.loc 1 274 24 view .LVU473
 1532 017a 84ED167A 		vstr.32	s14, [r4, #88]
 275:Core/Src/foc.c ****        controller->q_int += controller->k_q*controller->ki_q*i_q_error;
 1533              		.loc 1 275 8 is_stmt 1 view .LVU474
 1534              		.loc 1 275 55 is_stmt 0 view .LVU475
 1535 017e 94ED217A 		vldr.32	s14, [r4, #132]
 1536              		.loc 1 275 44 view .LVU476
 1537 0182 67EE877A 		vmul.f32	s15, s15, s14
 1538              		.loc 1 275 61 view .LVU477
 1539 0186 67EE887A 		vmul.f32	s15, s15, s16
 1540              		.loc 1 275 26 view .LVU478
 1541 018a 30EE270A 		vadd.f32	s0, s0, s15
 1542 018e 84ED260A 		vstr.32	s0, [r4, #152]
 276:Core/Src/foc.c ****        controller->q_int = fast_fmaxf(fast_fminf(controller->q_int, controller->v_max), -controller
 1543              		.loc 1 276 8 is_stmt 1 view .LVU479
 1544              		.loc 1 276 28 is_stmt 0 view .LVU480
 1545 0192 F0EE680A 		vmov.f32	s1, s17
 1546 0196 FFF7FEFF 		bl	fast_fminf
 1547              	.LVL112:
 1548              		.loc 1 276 100 view .LVU481
 1549 019a D4ED3B0A 		vldr.32	s1, [r4, #236]
 1550              		.loc 1 276 28 view .LVU482
 1551 019e F1EE600A 		vneg.f32	s1, s1
 1552 01a2 FFF7FEFF 		bl	fast_fmaxf
 1553              	.LVL113:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 33


 1554              		.loc 1 276 26 view .LVU483
 1555 01a6 84ED260A 		vstr.32	s0, [r4, #152]
 277:Core/Src/foc.c ****        controller->v_ref = sqrtf(controller->v_d*controller->v_d + controller->v_q*controller->v_q)
 1556              		.loc 1 277 8 is_stmt 1 view .LVU484
 1557              		.loc 1 277 44 is_stmt 0 view .LVU485
 1558 01aa 94ED150A 		vldr.32	s0, [r4, #84]
 1559              		.loc 1 277 49 view .LVU486
 1560 01ae 20EE000A 		vmul.f32	s0, s0, s0
 1561              		.loc 1 277 78 view .LVU487
 1562 01b2 D4ED167A 		vldr.32	s15, [r4, #88]
 1563              		.loc 1 277 83 view .LVU488
 1564 01b6 67EEA77A 		vmul.f32	s15, s15, s15
 1565              		.loc 1 277 28 view .LVU489
 1566 01ba 30EE270A 		vadd.f32	s0, s0, s15
 1567 01be FFF7FEFF 		bl	sqrtf
 1568              	.LVL114:
 1569              		.loc 1 277 26 view .LVU490
 1570 01c2 84ED3C0A 		vstr.32	s0, [r4, #240]
 278:Core/Src/foc.c ****        controller->v_q = fast_fmaxf(fast_fminf(controller->v_q, vq_max), -vq_max);
 1571              		.loc 1 278 8 is_stmt 1 view .LVU491
 1572              		.loc 1 278 26 is_stmt 0 view .LVU492
 1573 01c6 F0EE680A 		vmov.f32	s1, s17
 1574 01ca 94ED160A 		vldr.32	s0, [r4, #88]
 1575 01ce FFF7FEFF 		bl	fast_fminf
 1576              	.LVL115:
 1577 01d2 F1EE680A 		vneg.f32	s1, s17
 1578 01d6 FFF7FEFF 		bl	fast_fmaxf
 1579              	.LVL116:
 1580              		.loc 1 278 24 view .LVU493
 1581 01da 84ED160A 		vstr.32	s0, [r4, #88]
 279:Core/Src/foc.c **** 
 280:Core/Src/foc.c ****        limit_norm(&controller->v_d, &controller->v_q, controller->v_max);
 1582              		.loc 1 280 8 is_stmt 1 view .LVU494
 1583 01de 94ED3B0A 		vldr.32	s0, [r4, #236]
 1584 01e2 04F15801 		add	r1, r4, #88
 1585 01e6 04F15400 		add	r0, r4, #84
 1586 01ea FFF7FEFF 		bl	limit_norm
 1587              	.LVL117:
 281:Core/Src/foc.c **** 
 282:Core/Src/foc.c ****        abc(controller->theta_elec + 1.5f*DT*controller->dtheta_elec, controller->v_d, controller->v
 1588              		.loc 1 282 8 view .LVU495
 1589              		.loc 1 282 22 is_stmt 0 view .LVU496
 1590 01ee 94ED0B0A 		vldr.32	s0, [r4, #44]
 1591              		.loc 1 282 55 view .LVU497
 1592 01f2 D4ED0D7A 		vldr.32	s15, [r4, #52]
 1593              		.loc 1 282 44 view .LVU498
 1594 01f6 9FED1A7A 		vldr.32	s14, .L70+24
 1595 01fa 67EE877A 		vmul.f32	s15, s15, s14
 1596              		.loc 1 282 8 view .LVU499
 1597 01fe 04F17002 		add	r2, r4, #112
 1598 0202 04F16C01 		add	r1, r4, #108
 1599 0206 04F16800 		add	r0, r4, #104
 1600 020a 94ED161A 		vldr.32	s2, [r4, #88]
 1601 020e D4ED150A 		vldr.32	s1, [r4, #84]
 1602 0212 30EE270A 		vadd.f32	s0, s0, s15
 1603 0216 FFF7FEFF 		bl	abc
 1604              	.LVL118:
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 34


 283:Core/Src/foc.c ****        svm(controller->v_max, controller->v_u, controller->v_v, controller->v_w, &controller->dtc_u
 1605              		.loc 1 283 8 is_stmt 1 view .LVU500
 1606 021a 04F16402 		add	r2, r4, #100
 1607 021e 04F16001 		add	r1, r4, #96
 1608 0222 04F15C00 		add	r0, r4, #92
 1609 0226 D4ED1C1A 		vldr.32	s3, [r4, #112]
 1610 022a 94ED1B1A 		vldr.32	s2, [r4, #108]
 1611 022e D4ED1A0A 		vldr.32	s1, [r4, #104]
 1612 0232 94ED3B0A 		vldr.32	s0, [r4, #236]
 1613 0236 FFF7FEFF 		bl	svm
 1614              	.LVL119:
 284:Core/Src/foc.c **** 
 285:Core/Src/foc.c ****        set_dtc(controller);
 1615              		.loc 1 285 8 view .LVU501
 1616 023a 2046     		mov	r0, r4
 1617 023c FFF7FEFF 		bl	set_dtc
 1618              	.LVL120:
 286:Core/Src/foc.c **** 
 287:Core/Src/foc.c ****     }
 1619              		.loc 1 287 5 is_stmt 0 view .LVU502
 1620 0240 BDEC048B 		vldm	sp!, {d8-d9}
 1621              		.cfi_restore 82
 1622              		.cfi_restore 83
 1623              		.cfi_restore 80
 1624              		.cfi_restore 81
 1625              		.cfi_def_cfa_offset 16
 1626              	.LVL121:
 1627              		.loc 1 287 5 view .LVU503
 1628 0244 38BD     		pop	{r3, r4, r5, pc}
 1629              	.LVL122:
 1630              	.L71:
 1631              		.loc 1 287 5 view .LVU504
 1632 0246 00BF     		.align	2
 1633              	.L70:
 1634 0248 00000000 		.word	__float_reg
 1635 024c 6666663F 		.word	1063675494
 1636 0250 CDCCCC3D 		.word	1036831949
 1637 0254 D7A3703F 		.word	1064346583
 1638 0258 3ACD133F 		.word	1058262330
 1639 025c 00000000 		.word	0
 1640 0260 51491D38 		.word	941443409
 1641              		.cfi_endproc
 1642              	.LFE251:
 1644              		.section	.text.torque_control,"ax",%progbits
 1645              		.align	1
 1646              		.global	torque_control
 1647              		.syntax unified
 1648              		.thumb
 1649              		.thumb_func
 1651              	torque_control:
 1652              	.LVL123:
 1653              	.LFB252:
 288:Core/Src/foc.c **** 
 289:Core/Src/foc.c **** 
 290:Core/Src/foc.c **** void torque_control(ControllerStruct *controller){
 1654              		.loc 1 290 50 is_stmt 1 view -0
 1655              		.cfi_startproc
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 35


 1656              		@ args = 0, pretend = 0, frame = 0
 1657              		@ frame_needed = 0, uses_anonymous_args = 0
 1658              		.loc 1 290 50 is_stmt 0 view .LVU506
 1659 0000 10B5     		push	{r4, lr}
 1660              		.cfi_def_cfa_offset 8
 1661              		.cfi_offset 4, -8
 1662              		.cfi_offset 14, -4
 1663 0002 0446     		mov	r4, r0
 291:Core/Src/foc.c **** 	// don't use filter for RF company
 292:Core/Src/foc.c ****     // controller->t_ff_filt = 0.9f*controller->t_ff_filt + 0.1f*controller->t_ff;
 293:Core/Src/foc.c ****     controller->t_ff_filt = controller->t_ff;
 1664              		.loc 1 293 5 is_stmt 1 view .LVU507
 1665              		.loc 1 293 39 is_stmt 0 view .LVU508
 1666 0004 90ED3A0A 		vldr.32	s0, [r0, #232]
 1667              		.loc 1 293 27 view .LVU509
 1668 0008 80ED2F0A 		vstr.32	s0, [r0, #188]
 294:Core/Src/foc.c ****     float torque_des = controller->kp*(controller->p_des - controller->theta_mech) + controller->t_
 1669              		.loc 1 294 5 is_stmt 1 view .LVU510
 1670              		.loc 1 294 34 is_stmt 0 view .LVU511
 1671 000c D0ED387A 		vldr.32	s15, [r0, #224]
 1672              		.loc 1 294 50 view .LVU512
 1673 0010 90ED367A 		vldr.32	s14, [r0, #216]
 1674              		.loc 1 294 70 view .LVU513
 1675 0014 D0ED0A6A 		vldr.32	s13, [r0, #40]
 1676              		.loc 1 294 58 view .LVU514
 1677 0018 37EE667A 		vsub.f32	s14, s14, s13
 1678              		.loc 1 294 38 view .LVU515
 1679 001c 67EE877A 		vmul.f32	s15, s15, s14
 1680              		.loc 1 294 84 view .LVU516
 1681 0020 30EE270A 		vadd.f32	s0, s0, s15
 1682              		.loc 1 294 120 view .LVU517
 1683 0024 D0ED397A 		vldr.32	s15, [r0, #228]
 1684              		.loc 1 294 136 view .LVU518
 1685 0028 90ED377A 		vldr.32	s14, [r0, #220]
 1686              		.loc 1 294 156 view .LVU519
 1687 002c D0ED0C6A 		vldr.32	s13, [r0, #48]
 1688              		.loc 1 294 144 view .LVU520
 1689 0030 37EE667A 		vsub.f32	s14, s14, s13
 1690              		.loc 1 294 124 view .LVU521
 1691 0034 67EE877A 		vmul.f32	s15, s15, s14
 1692              		.loc 1 294 11 view .LVU522
 1693 0038 30EE270A 		vadd.f32	s0, s0, s15
 1694              	.LVL124:
 295:Core/Src/foc.c ****     controller->i_q_des = fast_fmaxf(fast_fminf(torque_des/(KT*GR), controller->i_max), -controller
 1695              		.loc 1 295 5 is_stmt 1 view .LVU523
 1696              		.loc 1 295 61 is_stmt 0 view .LVU524
 1697 003c 124B     		ldr	r3, .L77
 1698 003e D3ED0E7A 		vldr.32	s15, [r3, #56]
 1699              		.loc 1 295 64 view .LVU525
 1700 0042 93ED117A 		vldr.32	s14, [r3, #68]
 1701              		.loc 1 295 63 view .LVU526
 1702 0046 67EE877A 		vmul.f32	s15, s15, s14
 1703              		.loc 1 295 27 view .LVU527
 1704 004a D0ED400A 		vldr.32	s1, [r0, #256]
 1705 004e 80EE270A 		vdiv.f32	s0, s0, s15
 1706              	.LVL125:
 1707              		.loc 1 295 27 view .LVU528
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 36


 1708 0052 FFF7FEFF 		bl	fast_fminf
 1709              	.LVL126:
 1710              		.loc 1 295 100 view .LVU529
 1711 0056 D4ED400A 		vldr.32	s1, [r4, #256]
 1712              		.loc 1 295 27 view .LVU530
 1713 005a F1EE600A 		vneg.f32	s1, s1
 1714 005e FFF7FEFF 		bl	fast_fmaxf
 1715              	.LVL127:
 1716              		.loc 1 295 25 view .LVU531
 1717 0062 84ED2C0A 		vstr.32	s0, [r4, #176]
 296:Core/Src/foc.c ****     if(controller->v_bus > V_BUS_MAX){controller->i_q_des = 0;}
 1718              		.loc 1 296 5 is_stmt 1 view .LVU532
 1719              		.loc 1 296 18 is_stmt 0 view .LVU533
 1720 0066 94ED087A 		vldr.32	s14, [r4, #32]
 1721              		.loc 1 296 7 view .LVU534
 1722 006a DFED087A 		vldr.32	s15, .L77+4
 1723 006e B4EEE77A 		vcmpe.f32	s14, s15
 1724 0072 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1725 0076 02DD     		ble	.L73
 1726              		.loc 1 296 39 is_stmt 1 discriminator 1 view .LVU535
 1727              		.loc 1 296 59 is_stmt 0 discriminator 1 view .LVU536
 1728 0078 0023     		movs	r3, #0
 1729 007a C4F8B030 		str	r3, [r4, #176]	@ float
 1730              	.L73:
 297:Core/Src/foc.c ****     controller->i_d_des = 0.0f;
 1731              		.loc 1 297 5 is_stmt 1 view .LVU537
 1732              		.loc 1 297 25 is_stmt 0 view .LVU538
 1733 007e 0023     		movs	r3, #0
 1734 0080 C4F8AC30 		str	r3, [r4, #172]	@ float
 298:Core/Src/foc.c **** }
 1735              		.loc 1 298 1 view .LVU539
 1736 0084 10BD     		pop	{r4, pc}
 1737              	.LVL128:
 1738              	.L78:
 1739              		.loc 1 298 1 view .LVU540
 1740 0086 00BF     		.align	2
 1741              	.L77:
 1742 0088 00000000 		.word	__float_reg
 1743 008c 00002042 		.word	1109393408
 1744              		.cfi_endproc
 1745              	.LFE252:
 1747              		.section	.text.zero_commands,"ax",%progbits
 1748              		.align	1
 1749              		.global	zero_commands
 1750              		.syntax unified
 1751              		.thumb
 1752              		.thumb_func
 1754              	zero_commands:
 1755              	.LVL129:
 1756              	.LFB253:
 299:Core/Src/foc.c **** 
 300:Core/Src/foc.c **** void zero_commands(ControllerStruct * controller){
 1757              		.loc 1 300 50 is_stmt 1 view -0
 1758              		.cfi_startproc
 1759              		@ args = 0, pretend = 0, frame = 0
 1760              		@ frame_needed = 0, uses_anonymous_args = 0
 1761              		@ link register save eliminated.
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 37


 301:Core/Src/foc.c **** 	controller->t_ff = 0;
 1762              		.loc 1 301 2 view .LVU542
 1763              		.loc 1 301 19 is_stmt 0 view .LVU543
 1764 0000 0023     		movs	r3, #0
 1765 0002 C0F8E830 		str	r3, [r0, #232]	@ float
 302:Core/Src/foc.c **** 	controller->kp = 0;
 1766              		.loc 1 302 2 is_stmt 1 view .LVU544
 1767              		.loc 1 302 17 is_stmt 0 view .LVU545
 1768 0006 C0F8E030 		str	r3, [r0, #224]	@ float
 303:Core/Src/foc.c **** 	controller->kd = 0;
 1769              		.loc 1 303 2 is_stmt 1 view .LVU546
 1770              		.loc 1 303 17 is_stmt 0 view .LVU547
 1771 000a C0F8E430 		str	r3, [r0, #228]	@ float
 304:Core/Src/foc.c **** 	controller->p_des = 0;
 1772              		.loc 1 304 2 is_stmt 1 view .LVU548
 1773              		.loc 1 304 20 is_stmt 0 view .LVU549
 1774 000e C0F8D830 		str	r3, [r0, #216]	@ float
 305:Core/Src/foc.c **** 	controller->v_des = 0;
 1775              		.loc 1 305 2 is_stmt 1 view .LVU550
 1776              		.loc 1 305 20 is_stmt 0 view .LVU551
 1777 0012 C0F8DC30 		str	r3, [r0, #220]	@ float
 306:Core/Src/foc.c **** 	controller->i_q_des = 0;
 1778              		.loc 1 306 2 is_stmt 1 view .LVU552
 1779              		.loc 1 306 22 is_stmt 0 view .LVU553
 1780 0016 C0F8B030 		str	r3, [r0, #176]	@ float
 307:Core/Src/foc.c **** }
 1781              		.loc 1 307 1 view .LVU554
 1782 001a 7047     		bx	lr
 1783              		.cfi_endproc
 1784              	.LFE253:
 1786              		.text
 1787              	.Letext0:
 1788              		.file 2 "d:\\st\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\machine\\_default
 1789              		.file 3 "d:\\st\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\sys\\_stdint.h"
 1790              		.file 4 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f446xx.h"
 1791              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f4xx.h"
 1792              		.file 6 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 1793              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 1794              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_adc.h"
 1795              		.file 9 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_tim.h"
 1796              		.file 10 "Core/Inc/position_sensor.h"
 1797              		.file 11 "Core/Inc/foc.h"
 1798              		.file 12 "Core/Inc/adc.h"
 1799              		.file 13 "Core/Inc/tim.h"
 1800              		.file 14 "Core/Inc/user_config.h"
 1801              		.file 15 "Core/Inc/math_ops.h"
 1802              		.file 16 "d:\\st\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\math.h"
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 38


DEFINED SYMBOLS
                            *ABS*:00000000 foc.c
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:20     .text.set_dtc:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:26     .text.set_dtc:00000000 set_dtc
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:119    .text.set_dtc:000000a8 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:125    .text.analog_sample:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:131    .text.analog_sample:00000000 analog_sample
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:257    .text.analog_sample:000000a0 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:266    .text.abc:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:272    .text.abc:00000000 abc
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:378    .text.abc:00000094 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:384    .text.dq0:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:390    .text.dq0:00000000 dq0
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:506    .text.dq0:000000a0 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:513    .text.svm:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:519    .text.svm:00000000 svm
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:654    .text.svm:000000cc $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:661    .text.zero_current:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:667    .text.zero_current:00000000 zero_current
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:764    .text.zero_current:00000050 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:773    .text.init_controller_params:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:779    .text.init_controller_params:00000000 init_controller_params
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:925    .text.init_controller_params:000000e4 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:943    .text.reset_foc:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:949    .text.reset_foc:00000000 reset_foc
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1028   .text.reset_foc:0000006c $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1033   .text.reset_observer:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1039   .text.reset_observer:00000000 reset_observer
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1053   .text.update_observer:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1059   .text.update_observer:00000000 update_observer
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1073   .text.linearize_dtc:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1079   .text.linearize_dtc:00000000 linearize_dtc
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1151   .text.linearize_dtc:00000064 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1159   .text.field_weaken:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1165   .text.field_weaken:00000000 field_weaken
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1292   .text.field_weaken:000000c4 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1298   .text.commutate:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1304   .text.commutate:00000000 commutate
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1634   .text.commutate:00000248 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1645   .text.torque_control:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1651   .text.torque_control:00000000 torque_control
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1742   .text.torque_control:00000088 $d
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1748   .text.zero_commands:00000000 $t
C:\Users\16323\AppData\Local\Temp\cczSWZNV.s:1754   .text.zero_commands:00000000 zero_commands

UNDEFINED SYMBOLS
__int_reg
htim1
HAL_ADC_GetValue
HAL_ADC_Start
HAL_ADC_PollForConversion
hadc1
hadc2
hadc3
cos_lut
sin_lut
fminf3
ARM GAS  C:\Users\16323\AppData\Local\Temp\cczSWZNV.s 			page 39


fmaxf3
fast_fmaxf
fast_fminf
__aeabi_f2d
__aeabi_dmul
__aeabi_dadd
__aeabi_d2f
exp
__float_reg
sqrtf
limit_norm
